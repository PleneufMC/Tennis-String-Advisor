<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Configurateur Expert - Tennis String Advisor</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- DEFER external scripts to prevent interference with event listeners -->
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script defer src="/js/rcs-calculator.js"></script>
  <style>
    .animate-fade-in { animation: fadeIn 0.3s ease-in; }
    @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
  </style>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            tennis: { green: '#16a34a', dark: '#0d1117', light: '#f0fdf4' }
          }
        }
      }
    }
  </script>
  <style>
    .step-active { background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%); }
    .step-completed { background: #16a34a; }
    .step-pending { background: #e5e7eb; }
    
    /* SOLUTION 8: Radio button approach - immune to external scripts */
    input[type="radio"].option-input { 
      position: absolute;
      opacity: 0;
      pointer-events: none;
    }
    
    .option-card { 
      transition: all 0.2s ease;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
      -webkit-user-select: none;
      cursor: pointer;
    }
    
    .option-card:hover { 
      border-color: #16a34a; 
      transform: translateY(-2px); 
    }
    
    .option-card:active { 
      transform: scale(0.98); 
    }
    
    /* Selected state via :checked pseudo-class */
    input[type="radio"].option-input:checked + .option-card { 
      border-color: #16a34a !important; 
      background: #f0fdf4 !important; 
    }
  </style>
  <!-- Google Analytics 4 - Load AFTER page interactions setup -->
  <script defer src="https://www.googletagmanager.com/gtag/js?id=G-YSSLHJ5WYD"></script>
  <script defer src="/js/analytics.js"></script>
</head>
<body class="bg-gray-50 min-h-screen">
  <!-- Premium Paywall Modal -->
  <div id="configuratorPaywall" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] hidden items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full overflow-hidden animate-fade-in">
      <div class="bg-gradient-to-r from-amber-500 to-orange-500 p-6 text-white text-center">
        <span class="text-5xl block mb-3">üîí</span>
        <h2 class="text-2xl font-bold">Essai Gratuit Utilis√©</h2>
        <p class="text-white/90 mt-2">Vous avez utilis√© votre configuration gratuite</p>
      </div>
      <div class="p-6">
        <div class="bg-green-50 border border-green-200 rounded-xl p-4 mb-6">
          <h3 class="font-semibold text-green-800 flex items-center gap-2">
            <span>‚ú®</span> Passez Premium pour continuer
          </h3>
          <ul class="mt-3 space-y-2 text-sm text-green-700">
            <li class="flex items-center gap-2"><span>‚úì</span> Configurations illimit√©es</li>
            <li class="flex items-center gap-2"><span>‚úì</span> Calculs RCS illimit√©s</li>
            <li class="flex items-center gap-2"><span>‚úì</span> Sauvegarde de vos setups</li>
            <li class="flex items-center gap-2"><span>‚úì</span> Journal de cordage</li>
            <li class="flex items-center gap-2"><span>‚úì</span> Alertes prix</li>
            <li class="flex items-center gap-2"><span>‚úì</span> Export PDF</li>
          </ul>
        </div>
        <div class="text-center mb-4">
          <span class="text-3xl font-bold text-gray-900">2,99‚Ç¨</span>
          <span class="text-gray-600">/mois</span>
          <p class="text-sm text-gray-500 mt-1">ou 24,99‚Ç¨/an (2 mois offerts)</p>
        </div>
        <div class="space-y-3">
          <a href="/premium.html" class="block w-full py-3 px-6 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold rounded-xl text-center hover:from-amber-600 hover:to-orange-600 transition shadow-lg">
            ‚ú® Devenir Premium
          </a>
          <a href="/auth.html" id="paywallAuthLink" class="block w-full py-3 px-6 border-2 border-gray-300 text-gray-700 font-medium rounded-xl text-center hover:bg-gray-50 transition">
            Cr√©er un compte gratuit
          </a>
        </div>
        <p class="text-xs text-gray-500 text-center mt-4">
          Le compte gratuit inclut 1 configuration. Premium = illimit√©.
        </p>
      </div>
    </div>
  </div>

  <!-- Free Trial Banner -->
  <div id="freeTrialBanner" class="hidden bg-gradient-to-r from-green-500 to-green-600 text-white py-3 px-4 text-center">
    <span class="font-medium">üéÅ Essai gratuit : <span id="remainingConfigurations">1</span> configuration restante</span>
    <span class="mx-2">|</span>
    <a href="/premium.html" class="underline font-semibold hover:text-green-100">Passer Premium pour illimit√© ‚Üí</a>
  </div>

  <!-- Premium Banner -->
  <div id="premiumBanner" class="hidden bg-gradient-to-r from-amber-500 to-orange-500 text-white py-2 px-4 text-center">
    <span class="font-medium">‚ú® Membre Premium - Configurations illimit√©es</span>
  </div>
  <!-- Header -->
  <header class="bg-white border-b border-gray-200 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 py-4">
      <div class="flex items-center justify-between">
        <a href="/" class="flex items-center gap-2">
          <span class="text-2xl">üéæ</span>
          <span class="font-bold text-xl text-gray-900">Tennis String Advisor</span>
        </a>
        <nav class="hidden md:flex items-center gap-6">
          <a href="/" class="text-gray-600 hover:text-green-600 transition">Accueil</a>
          <a href="/configurator.html" class="text-green-600 font-semibold">Configurateur</a>
          <a href="/racquets.html" class="text-gray-600 hover:text-green-600 transition">Raquettes</a>
          <a href="/strings.html" class="text-gray-600 hover:text-green-600 transition">Cordages</a>
          <a href="/compare.html" class="text-gray-600 hover:text-green-600 transition">Comparateur</a>
          <a href="/rcs-calculator.html" class="text-gray-600 hover:text-green-600 transition">ü©∫ RCS</a>
        </nav>
        <a href="/auth.html" id="authLink" class="hidden md:flex items-center gap-2 px-4 py-2 text-sm font-medium text-green-600 hover:bg-green-50 rounded-lg transition">
          üë§ Mon Compte
        </a>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-4xl mx-auto px-4 py-8">
    <!-- Page Header -->
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold text-gray-900 mb-2">Configurateur Expert 2025</h1>
      <p class="text-gray-600">Trouvez le setup parfait adapt√© √† votre style de jeu en quelques √©tapes</p>
    </div>

    <!-- Progress Steps -->
    <div class="flex justify-center items-center gap-4 mb-12">
      <div class="flex items-center gap-2">
        <div class="w-10 h-10 rounded-full flex items-center justify-center text-white font-bold step-active" id="step1-indicator">1</div>
        <span class="text-sm font-medium text-gray-700">Profil</span>
      </div>
      <div class="w-16 h-1 bg-gray-200 rounded" id="progress1"></div>
      <div class="flex items-center gap-2">
        <div class="w-10 h-10 rounded-full flex items-center justify-center text-gray-500 font-bold step-pending" id="step2-indicator">2</div>
        <span class="text-sm font-medium text-gray-500">Style</span>
      </div>
      <div class="w-16 h-1 bg-gray-200 rounded" id="progress2"></div>
      <div class="flex items-center gap-2">
        <div class="w-10 h-10 rounded-full flex items-center justify-center text-gray-500 font-bold step-pending" id="step3-indicator">3</div>
        <span class="text-sm font-medium text-gray-500">Budget</span>
      </div>
      <div class="w-16 h-1 bg-gray-200 rounded" id="progress3"></div>
      <div class="flex items-center gap-2">
        <div class="w-10 h-10 rounded-full flex items-center justify-center text-gray-500 font-bold step-pending" id="step4-indicator">4</div>
        <span class="text-sm font-medium text-gray-500">R√©sultat</span>
      </div>
    </div>

    <!-- Step 1: Player Profile -->
    <div id="step1" class="bg-white rounded-xl shadow-sm border border-gray-200 p-8">
      <h2 class="text-xl font-bold text-gray-900 mb-6">Quel est votre niveau de jeu ?</h2>
      
      <div id="level-group" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
        <div>
          <input type="radio" name="level" id="level-debutant" value="debutant" class="option-input">
          <label for="level-debutant" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">
            <div class="text-3xl mb-3">üå±</div>
            <h3 class="font-semibold text-gray-900 mb-1">D√©butant</h3>
            <p class="text-sm text-gray-500">Moins de 2 ans de pratique, apprentissage des bases</p>
          </label>
        </div>
        <div>
          <input type="radio" name="level" id="level-intermediaire" value="intermediaire" class="option-input">
          <label for="level-intermediaire" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">
            <div class="text-3xl mb-3">üìà</div>
            <h3 class="font-semibold text-gray-900 mb-1">Interm√©diaire</h3>
            <p class="text-sm text-gray-500">2-5 ans de pratique, technique en progression</p>
          </label>
        </div>
        <div>
          <input type="radio" name="level" id="level-avance" value="avance" class="option-input">
          <label for="level-avance" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">
            <div class="text-3xl mb-3">‚≠ê</div>
            <h3 class="font-semibold text-gray-900 mb-1">Avanc√©</h3>
            <p class="text-sm text-gray-500">5+ ans de pratique, ma√Ætrise technique</p>
          </label>
        </div>
        <div>
          <input type="radio" name="level" id="level-competition" value="competition" class="option-input">
          <label for="level-competition" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">
            <div class="text-3xl mb-3">üèÜ</div>
            <h3 class="font-semibold text-gray-900 mb-1">Comp√©tition</h3>
            <p class="text-sm text-gray-500">Joueur class√©, entra√Ænement r√©gulier intensif</p>
          </label>
        </div>
      </div>

      <h2 class="text-xl font-bold text-gray-900 mb-6">√Ä quelle fr√©quence jouez-vous ?</h2>
      
      <div id="frequency-group" class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <input type="radio" name="frequency" id="frequency-occasionnel" value="occasionnel" class="option-input">
          <label for="frequency-occasionnel" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">
            <div class="text-3xl mb-3">üéæ</div>
            <h3 class="font-semibold text-gray-900 mb-1">Occasionnel</h3>
            <p class="text-sm text-gray-500">1-2 fois par mois</p>
          </label>
        </div>
        <div>
          <input type="radio" name="frequency" id="frequency-regulier" value="regulier" class="option-input">
          <label for="frequency-regulier" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">
            <div class="text-3xl mb-3">üìÖ</div>
            <h3 class="font-semibold text-gray-900 mb-1">R√©gulier</h3>
            <p class="text-sm text-gray-500">1-2 fois par semaine</p>
          </label>
        </div>
        <div>
          <input type="radio" name="frequency" id="frequency-intensif" value="intensif" class="option-input">
          <label for="frequency-intensif" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">
            <div class="text-3xl mb-3">üî•</div>
            <h3 class="font-semibold text-gray-900 mb-1">Intensif</h3>
            <p class="text-sm text-gray-500">3+ fois par semaine</p>
          </label>
        </div>
      </div>

      <div class="flex justify-end mt-8">
        <button id="nextStep1" onclick="goToStep(2); return false;" class="px-6 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition">
          Suivant ‚Üí
        </button>
      </div>
    </div>

    <!-- Step 2: Playing Style -->
    <div id="step2" class="bg-white rounded-xl shadow-sm border border-gray-200 p-8 hidden">
      <h2 class="text-xl font-bold text-gray-900 mb-6">Quel est votre style de jeu ?</h2>
      
      <div id="style-group" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
        <div>

          <input type="radio" name="style" id="style_puissance" value="puissance" class="option-input">

          <label for="style_puissance" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">

            <div class="text-3xl mb-3">üí•

          </label>

        </div>
          <h3 class="font-semibold text-gray-900 mb-1">Puissance</h3>
          <p class="text-sm text-gray-500">Frappes lourdes, service puissant, jeu agressif</p>
        </div>
        <div>

          <input type="radio" name="style" id="style_controle" value="controle" class="option-input">

          <label for="style_controle" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">

            <div class="text-3xl mb-3">üéØ

          </label>

        </div>
          <h3 class="font-semibold text-gray-900 mb-1">Contr√¥le</h3>
          <p class="text-sm text-gray-500">Pr√©cision, placement, construction du point</p>
        </div>
        <div>

          <input type="radio" name="style" id="style_spin" value="spin" class="option-input">

          <label for="style_spin" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">

            <div class="text-3xl mb-3">üåÄ

          </label>

        </div>
          <h3 class="font-semibold text-gray-900 mb-1">Spin / Lift√©</h3>
          <p class="text-sm text-gray-500">Effets importants, jeu en fond de court</p>
        </div>
        <div>

          <input type="radio" name="style" id="style_polyvalent" value="polyvalent" class="option-input">

          <label for="style_polyvalent" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">

            <div class="text-3xl mb-3">‚öñÔ∏è

          </label>

        </div>
          <h3 class="font-semibold text-gray-900 mb-1">Polyvalent</h3>
          <p class="text-sm text-gray-500">√âquilibr√©, adaptable √† toutes les situations</p>
        </div>
      </div>

      <h2 class="text-xl font-bold text-gray-900 mb-6">Avez-vous des probl√®mes physiques ?</h2>
      
      <div id="physical-group" class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>

          <input type="radio" name="physical" id="physical_aucun" value="aucun" class="option-input">

          <label for="physical_aucun" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">

            <div class="text-3xl mb-3">üí™

          </label>

        </div>
          <h3 class="font-semibold text-gray-900 mb-1">Aucun</h3>
          <p class="text-sm text-gray-500">Pas de probl√®me particulier</p>
        </div>
        <div>

          <input type="radio" name="physical" id="physical_bras" value="bras" class="option-input">

          <label for="physical_bras" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">

            <div class="text-3xl mb-3">ü¶æ

          </label>

        </div>
          <h3 class="font-semibold text-gray-900 mb-1">Bras sensible</h3>
          <p class="text-sm text-gray-500">Tennis elbow, douleurs au coude</p>
        </div>
        <div>

          <input type="radio" name="physical" id="physical_epaule" value="epaule" class="option-input">

          <label for="physical_epaule" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">

            <div class="text-3xl mb-3">ü©π

          </label>

        </div>
          <h3 class="font-semibold text-gray-900 mb-1">√âpaule fragile</h3>
          <p class="text-sm text-gray-500">Douleurs √† l'√©paule</p>
        </div>
      </div>

      <div class="flex justify-between mt-8">
        <button id="prevStep2" onclick="goToStep(1); return false;" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition">
          ‚Üê Pr√©c√©dent
        </button>
        <button id="nextStep2" onclick="goToStep(3); return false;" class="px-6 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition">
          Suivant ‚Üí
        </button>
      </div>
    </div>

    <!-- Step 3: Budget -->
    <div id="step3" class="bg-white rounded-xl shadow-sm border border-gray-200 p-8 hidden">
      <h2 class="text-xl font-bold text-gray-900 mb-6">Quel est votre budget pour la raquette ?</h2>
      
      <div id="budget-racquet-group" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
        <div>

          <input type="radio" name="budget-racquet" id="budget-racquet_eco" value="eco" class="option-input">

          <label for="budget-racquet_eco" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">

            <div class="text-3xl mb-3">üí∞

          </label>

        </div>
          <h3 class="font-semibold text-gray-900 mb-1">√âconomique</h3>
          <p class="text-sm text-gray-500">Moins de 150‚Ç¨</p>
        </div>
        <div>

          <input type="radio" name="budget-racquet" id="budget-racquet_medium" value="medium" class="option-input">

          <label for="budget-racquet_medium" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">

            <div class="text-3xl mb-3">üí∞üí∞

          </label>

        </div>
          <h3 class="font-semibold text-gray-900 mb-1">Moyen</h3>
          <p class="text-sm text-gray-500">150‚Ç¨ - 250‚Ç¨</p>
        </div>
        <div>

          <input type="radio" name="budget-racquet" id="budget-racquet_premium" value="premium" class="option-input">

          <label for="budget-racquet_premium" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">

            <div class="text-3xl mb-3">üíé

          </label>

        </div>
          <h3 class="font-semibold text-gray-900 mb-1">Premium</h3>
          <p class="text-sm text-gray-500">Plus de 250‚Ç¨</p>
        </div>
      </div>

      <h2 class="text-xl font-bold text-gray-900 mb-6">Quel est votre budget pour le cordage ?</h2>
      
      <div id="budget-string-group" class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>

          <input type="radio" name="budget-string" id="budget-string_eco" value="eco" class="option-input">

          <label for="budget-string_eco" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">

            <div class="text-3xl mb-3">üßµ

          </label>

        </div>
          <h3 class="font-semibold text-gray-900 mb-1">√âconomique</h3>
          <p class="text-sm text-gray-500">Moins de 15‚Ç¨</p>
        </div>
        <div>

          <input type="radio" name="budget-string" id="budget-string_medium" value="medium" class="option-input">

          <label for="budget-string_medium" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">

            <div class="text-3xl mb-3">üß∂

          </label>

        </div>
          <h3 class="font-semibold text-gray-900 mb-1">Moyen</h3>
          <p class="text-sm text-gray-500">15‚Ç¨ - 25‚Ç¨</p>
        </div>
        <div>

          <input type="radio" name="budget-string" id="budget-string_premium" value="premium" class="option-input">

          <label for="budget-string_premium" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">

            <div class="text-3xl mb-3">‚ú®

          </label>

        </div>
          <h3 class="font-semibold text-gray-900 mb-1">Premium</h3>
          <p class="text-sm text-gray-500">Plus de 25‚Ç¨</p>
        </div>
      </div>

      <div class="flex justify-between mt-8">
        <button id="prevStep3" type="button" onclick="goToStep(2); return false;" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition">
          ‚Üê Pr√©c√©dent
        </button>
        <form id="generateForm" onsubmit="return handleGenerate();" style="display: inline;">
          <button 
            id="generateBtn" 
            type="submit" 
            class="px-6 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition" 
            ontouchstart=""
            ontouchend="handleGenerate(); return false;">
            Voir mes recommandations üéâ
          </button>
        </form>
      </div>
    </div>

    <!-- Step 4: Results -->
    <div id="step4" class="hidden">
      <div class="bg-gradient-to-r from-green-600 to-green-500 rounded-xl p-8 text-white mb-8">
        <h2 class="text-2xl font-bold mb-2">üéâ Votre Setup Personnalis√©</h2>
        <p class="opacity-90">Bas√© sur votre profil et vos pr√©f√©rences</p>
      </div>

      <!-- Recommended Racquet -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
        <div class="flex items-center gap-2 mb-4">
          <span class="text-2xl">üéæ</span>
          <h3 class="text-xl font-bold text-gray-900">Raquette Recommand√©e</h3>
        </div>
        
        <div class="bg-gray-50 rounded-lg p-6" id="recommended-racquet">
          <div class="flex justify-between items-start">
            <div>
              <span class="text-sm text-green-600 font-medium" id="rec-racquet-brand">Babolat</span>
              <h4 class="text-lg font-bold text-gray-900" id="rec-racquet-name">Pure Drive</h4>
            </div>
            <span class="bg-green-100 text-green-800 text-sm font-medium px-3 py-1 rounded-full" id="rec-racquet-category">Polyvalent</span>
          </div>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">
            <div>
              <span class="text-sm text-gray-500">Poids</span>
              <p class="font-semibold" id="rec-racquet-weight">300g</p>
            </div>
            <div>
              <span class="text-sm text-gray-500">T√™te</span>
              <p class="font-semibold" id="rec-racquet-head">100 sq in</p>
            </div>
            <div>
              <span class="text-sm text-gray-500">Rigidit√©</span>
              <p class="font-semibold" id="rec-racquet-stiffness">RA 72</p>
            </div>
            <div>
              <span class="text-sm text-gray-500">Prix</span>
              <p class="font-semibold text-green-600" id="rec-racquet-price">269‚Ç¨</p>
            </div>
          </div>
          <p class="text-gray-600 mt-4" id="rec-racquet-reason">Id√©ale pour les joueurs recherchant polyvalence et puissance.</p>
        </div>
      </div>

      <!-- Recommended String -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
        <div class="flex items-center gap-2 mb-4">
          <span class="text-2xl">üßµ</span>
          <h3 class="text-xl font-bold text-gray-900">Cordage Recommand√©</h3>
        </div>
        
        <div class="bg-gray-50 rounded-lg p-6" id="recommended-string">
          <div class="flex justify-between items-start">
            <div>
              <span class="text-sm text-blue-600 font-medium" id="rec-string-brand">Babolat</span>
              <h4 class="text-lg font-bold text-gray-900" id="rec-string-name">RPM Blast</h4>
            </div>
            <span class="bg-purple-100 text-purple-800 text-sm font-medium px-3 py-1 rounded-full" id="rec-string-type">Polyester</span>
          </div>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">
            <div>
              <span class="text-sm text-gray-500">Spin</span>
              <p class="font-semibold" id="rec-string-spin">10/10</p>
            </div>
            <div>
              <span class="text-sm text-gray-500">Contr√¥le</span>
              <p class="font-semibold" id="rec-string-control">8/10</p>
            </div>
            <div>
              <span class="text-sm text-gray-500">Confort</span>
              <p class="font-semibold" id="rec-string-comfort">5/10</p>
            </div>
            <div>
              <span class="text-sm text-gray-500">Prix</span>
              <p class="font-semibold text-green-600" id="rec-string-price">18‚Ç¨</p>
            </div>
          </div>
          <p class="text-gray-600 mt-4" id="rec-string-reason">Parfait pour g√©n√©rer du spin et du contr√¥le.</p>
        </div>
      </div>

      <!-- Tension Recommendation -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
        <div class="flex items-center gap-2 mb-4">
          <span class="text-2xl">‚öôÔ∏è</span>
          <h3 class="text-xl font-bold text-gray-900">Tension Recommand√©e</h3>
        </div>
        <div class="bg-blue-50 rounded-lg p-6">
          <div class="text-center">
            <span class="text-4xl font-bold text-blue-600" id="rec-tension">23-25 kg</span>
            <p class="text-gray-600 mt-2" id="rec-tension-reason">Tension moyenne pour un bon √©quilibre entre puissance et contr√¥le.</p>
          </div>
        </div>
      </div>

      <!-- RCS Score -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center gap-2">
            <span class="text-2xl">ü©∫</span>
            <h3 class="text-xl font-bold text-gray-900">Score RCS - Confort Articulaire</h3>
          </div>
          <a href="/rcs-calculator.html" class="text-sm text-green-600 hover:underline">Calculateur d√©taill√© ‚Üí</a>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Score Display -->
          <div class="text-center">
            <div id="rcs-score-display" class="inline-flex items-center justify-center w-28 h-28 rounded-full text-white text-4xl font-bold mb-3 shadow-lg" style="background: #FFD700;">
              50
            </div>
            <div id="rcs-decile-label" class="inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-bold" style="background: #FFD700; color: #000;">
              <span id="rcs-icon">‚öñÔ∏è</span>
              <span id="rcs-label">D5 - √âquilibr√© Souple</span>
            </div>
            <p id="rcs-description" class="text-gray-600 mt-2 text-sm">Club niveau moyen</p>
          </div>
          
          <!-- RCS Gauge -->
          <div class="flex flex-col justify-center">
            <div class="mb-3">
              <div class="h-4 rounded-full" style="background: linear-gradient(to right, #006400, #228B22, #32CD32, #9ACD32, #FFD700, #FFC000, #FF8C00, #FF6600, #FF4444, #CC0000);">
                <div id="rcs-indicator" class="w-5 h-5 bg-white border-4 border-gray-800 rounded-full shadow transform -translate-y-0.5" style="margin-left: 50%;"></div>
              </div>
              <div class="flex justify-between text-xs text-gray-500 mt-1">
                <span>Confort</span>
                <span>Performance</span>
              </div>
            </div>
            
            <div id="rcs-comment" class="p-3 rounded-lg text-sm" style="background: #FFD70020; border-left: 4px solid #FFD700;">
              <p class="text-gray-700"><strong>üí¨ Conseil :</strong> <span id="rcs-advice">Configuration √©quilibr√©e, adapt√©e √† la plupart des joueurs.</span></p>
            </div>
          </div>
        </div>
        
        <!-- Profile Evaluation -->
        <div id="rcs-profile-eval" class="hidden mt-4 p-4 rounded-lg border-2">
          <div class="flex items-center gap-2 font-semibold">
            <span id="rcs-eval-icon" class="text-xl">‚úÖ</span>
            <span id="rcs-eval-message">Configuration optimale pour votre profil</span>
          </div>
          <p id="rcs-eval-suggestion" class="mt-2 text-sm opacity-80"></p>
        </div>
      </div>

      <!-- Actions -->
      <div class="flex flex-col md:flex-row gap-4">
        <a href="/racquets.html" class="flex-1 px-6 py-4 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition text-center">
          Voir toutes les raquettes ‚Üí
        </a>
        <a href="/strings.html" class="flex-1 px-6 py-4 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition text-center">
          Voir tous les cordages ‚Üí
        </a>
        <button onclick="restartConfigurator()" class="flex-1 px-6 py-4 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition">
          üîÑ Recommencer
        </button>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-900 text-white mt-16">
    <div class="max-w-7xl mx-auto px-4 py-12">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div>
          <div class="flex items-center gap-2 mb-4">
            <span class="text-2xl">üéæ</span>
            <span class="font-bold text-xl">Tennis String Advisor</span>
          </div>
          <p class="text-gray-400 text-sm">Expert en cordages et raquettes de tennis depuis 2024.</p>
        </div>
        <div>
          <h4 class="font-semibold mb-4">Navigation</h4>
          <ul class="space-y-2 text-gray-400 text-sm">
            <li><a href="/" class="hover:text-white transition">Accueil</a></li>
            <li><a href="/racquets.html" class="hover:text-white transition">Raquettes</a></li>
            <li><a href="/strings.html" class="hover:text-white transition">Cordages</a></li>
            <li><a href="/compare.html" class="hover:text-white transition">Comparateur</a></li>
          </ul>
        </div>
        <div>
          <h4 class="font-semibold mb-4">Outils</h4>
          <ul class="space-y-2 text-gray-400 text-sm">
            <li><a href="/configurator.html" class="hover:text-white transition">Configurateur</a></li>
            <li><a href="/guides.html" class="hover:text-white transition">Guides</a></li>
            <li><a href="/faq.html" class="hover:text-white transition">FAQ</a></li>
          </ul>
        </div>
        <div>
          <h4 class="font-semibold mb-4">Contact</h4>
          <p class="text-gray-400 text-sm">pleneuftrading@gmail.com</p>
        </div>
      </div>
      <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400 text-sm">
        <p>¬© 2025 Tennis String Advisor. Une marque de Pleneuf Trading LLC. Tous droits r√©serv√©s.</p>
      </div>
    </div>
  </footer>

  <script>
    // Supabase config
    const SUPABASE_URL = 'https://yhhdkllbaxuhwrfpsmev.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InloaGRrbGxiYXh1aHdyZnBzbWV2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU3NjI0MDEsImV4cCI6MjA4MTMzODQwMX0.2aC_gYZf0xxz6MXi5zcaCH2S64RBaQvXU7a5qiuD0_k';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Configuration usage tracking
    let currentUser = null;
    let userProfile = null;
    let hasUsedFreeConfiguration = false;
    let isPremium = false;
    let configurationCount = 0;
    const FREE_CONFIGURATIONS = 1;
    const LOCAL_STORAGE_KEY = 'configurator_free_used';
    
    // Database cache
    let racquetsDB = [];
    let stringsDB = [];

    // SOLUTION 8: Read state from radio buttons instead of tracking in JS
    function getSelections() {
      return {
        level: document.querySelector('input[name="level"]:checked')?.value || null,
        frequency: document.querySelector('input[name="frequency"]:checked')?.value || null,
        style: document.querySelector('input[name="style"]:checked')?.value || null,
        physical: document.querySelector('input[name="physical"]:checked')?.value || null,
        'budget-racquet': document.querySelector('input[name="budget-racquet"]:checked')?.value || null,
        'budget-string': document.querySelector('input[name="budget-string"]:checked')?.value || null
      };
    }
    
    // Legacy selections object for compatibility (read from radio buttons)
    const selections = new Proxy({}, {
      get(target, prop) {
        const radioName = prop.toString();
        return document.querySelector(`input[name="${radioName}"]:checked`)?.value || null;
      }
    });

    // =====================================================
    // SOLUTION 8: NATIVE RADIO BUTTONS
    // =====================================================
    // No complex JavaScript needed! Radio buttons handle:
    // - Selection state (:checked pseudo-class)
    // - Mutual exclusivity (only one per name)
    // - Immune to external script interference
    // 
    // We just read values with querySelector when needed.

    // Navigate steps
    function goToStep(step) {
      // Hide all steps
      document.querySelectorAll('[id^="step"]').forEach(el => {
        if (!el.id.includes('indicator')) el.classList.add('hidden');
      });
      // Show target step
      document.getElementById('step' + step).classList.remove('hidden');
      
      // Update indicators
      for (let i = 1; i <= 4; i++) {
        const indicator = document.getElementById('step' + i + '-indicator');
        indicator.classList.remove('step-active', 'step-completed', 'step-pending');
        if (i < step) {
          indicator.classList.add('step-completed');
          indicator.classList.add('text-white');
        } else if (i === step) {
          indicator.classList.add('step-active');
          indicator.classList.add('text-white');
        } else {
          indicator.classList.add('step-pending');
          indicator.classList.remove('text-white');
          indicator.classList.add('text-gray-500');
        }
      }
      
      // Update progress bars
      for (let i = 1; i <= 3; i++) {
        const progress = document.getElementById('progress' + i);
        if (i < step) {
          progress.classList.remove('bg-gray-200');
          progress.classList.add('bg-green-500');
        } else {
          progress.classList.add('bg-gray-200');
          progress.classList.remove('bg-green-500');
        }
      }
    }

    // Check if user can configure
    function canConfigure() {
      if (isPremium) return true;
      
      if (currentUser) {
        return configurationCount < FREE_CONFIGURATIONS;
      } else {
        return !hasUsedFreeConfiguration;
      }
    }

    // Show paywall
    function showPaywall() {
      const paywall = document.getElementById('configuratorPaywall');
      paywall.classList.remove('hidden');
      paywall.classList.add('flex');
      document.body.style.overflow = 'hidden';
    }

    // Record configuration usage
    async function recordConfigurationUsage() {
      if (isPremium) return;
      
      if (currentUser) {
        configurationCount++;
        await supabase
          .from('profiles')
          .update({ configurator_uses: configurationCount })
          .eq('id', currentUser.id);
        
        hasUsedFreeConfiguration = configurationCount >= FREE_CONFIGURATIONS;
      } else {
        localStorage.setItem(LOCAL_STORAGE_KEY, 'true');
        hasUsedFreeConfiguration = true;
      }
      
      updateUsageBanners();
    }

    // Update banners
    function updateUsageBanners() {
      const freeTrialBanner = document.getElementById('freeTrialBanner');
      const premiumBanner = document.getElementById('premiumBanner');
      const remainingEl = document.getElementById('remainingConfigurations');
      
      if (isPremium) {
        freeTrialBanner.classList.add('hidden');
        premiumBanner.classList.remove('hidden');
      } else {
        premiumBanner.classList.add('hidden');
        const remaining = Math.max(0, FREE_CONFIGURATIONS - (currentUser ? configurationCount : (hasUsedFreeConfiguration ? 1 : 0)));
        remainingEl.textContent = remaining;
        
        if (remaining === 0) {
          freeTrialBanner.innerHTML = `
            <span class="font-medium">üîí Essai gratuit termin√©</span>
            <span class="mx-2">|</span>
            <a href="/premium.html" class="underline font-semibold hover:text-green-100">Passer Premium pour continuer ‚Üí</a>
          `;
          freeTrialBanner.classList.remove('from-green-500', 'to-green-600');
          freeTrialBanner.classList.add('from-amber-500', 'to-orange-500');
        }
        freeTrialBanner.classList.remove('hidden');
      }
    }

    // Check user status
    async function checkUserStatus() {
      try {
        const { data: { session } } = await supabase.auth.getSession();
        
        if (session) {
          currentUser = session.user;
          
          const { data: profile } = await supabase
            .from('profiles')
            .select('is_premium, configurator_uses')
            .eq('id', currentUser.id)
            .single();
          
          if (profile) {
            userProfile = profile;
            isPremium = profile.is_premium === true;
            configurationCount = profile.configurator_uses || 0;
            hasUsedFreeConfiguration = configurationCount >= FREE_CONFIGURATIONS;
          }
          
          document.getElementById('paywallAuthLink').textContent = 'Retour √† mon compte';
          document.getElementById('paywallAuthLink').href = '/account.html';
        } else {
          hasUsedFreeConfiguration = localStorage.getItem(LOCAL_STORAGE_KEY) === 'true';
        }
        
        updateUsageBanners();
      } catch (error) {
        console.error('Error checking user status:', error);
      }
    }

    // Load racquets and strings from database
    async function loadCatalogData() {
      try {
        // Load racquets
        const { data: racquets, error: rError } = await supabase
          .from('racquets')
          .select('*')
          .order('brand', { ascending: true });
        
        if (racquets) {
          racquetsDB = racquets;
          console.log(`Loaded ${racquetsDB.length} racquets from database`);
        }
        
        // Load strings
        const { data: strings, error: sError } = await supabase
          .from('strings')
          .select('*')
          .order('brand', { ascending: true });
        
        if (strings) {
          stringsDB = strings;
          console.log(`Loaded ${stringsDB.length} strings from database`);
        }
      } catch (error) {
        console.error('Error loading catalog:', error);
      }
    }

    // Initialize on load
    checkUserStatus();
    loadCatalogData();

    // Smart racquet picker based on criteria
    function pickBestRacquet(criteria) {
      if (racquetsDB.length === 0) {
        // Fallback to hardcoded if DB not loaded
        return null;
      }
      
      let candidates = [...racquetsDB];
      
      // Filter by player level
      if (criteria.level) {
        candidates = candidates.filter(r => {
          const levels = r.player_level || [];
          return levels.some(l => l.toLowerCase() === criteria.level.toLowerCase());
        });
      }
      
      // Filter by category
      if (criteria.category) {
        candidates = candidates.filter(r => {
          const cat = (r.category || '').toLowerCase();
          return criteria.category.some(c => cat.includes(c.toLowerCase()));
        });
      }
      
      // Filter by stiffness range (comfort requirement)
      if (criteria.maxStiffness) {
        candidates = candidates.filter(r => 
          r.stiffness && r.stiffness <= criteria.maxStiffness
        );
      }
      
      if (criteria.minStiffness) {
        candidates = candidates.filter(r => 
          r.stiffness && r.stiffness >= criteria.minStiffness
        );
      }
      
      // Sort by preference
      if (criteria.preferLightweight) {
        candidates.sort((a, b) => (a.weight || 300) - (b.weight || 300));
      }
      
      if (criteria.preferComfort) {
        candidates.sort((a, b) => (a.stiffness || 70) - (b.stiffness || 70));
      }
      
      // Pick one randomly from top 3 to add variety
      const topCandidates = candidates.slice(0, Math.min(3, candidates.length));
      return topCandidates[Math.floor(Math.random() * topCandidates.length)] || candidates[0];
    }

    // Smart string picker
    function pickBestString(criteria) {
      if (stringsDB.length === 0) {
        return null;
      }
      
      let candidates = [...stringsDB];
      
      // Filter by type
      if (criteria.types) {
        candidates = candidates.filter(s => {
          const type = (s.type || '').toLowerCase();
          return criteria.types.some(t => type.includes(t.toLowerCase()));
        });
      }
      
      // Sort by comfort if needed
      if (criteria.preferComfort) {
        candidates.sort((a, b) => (b.comfort || 5) - (a.comfort || 5));
      }
      
      // Sort by spin if needed
      if (criteria.preferSpin) {
        candidates.sort((a, b) => (b.spin || 5) - (a.spin || 5));
      }
      
      // Sort by control if needed
      if (criteria.preferControl) {
        candidates.sort((a, b) => (b.control || 5) - (a.control || 5));
      }
      
      const topCandidates = candidates.slice(0, Math.min(3, candidates.length));
      return topCandidates[Math.floor(Math.random() * topCandidates.length)] || candidates[0];
    }

    // Generate result
    function generateResult() {
      console.log('üéâ generateResult called!');
      
      // Get current selections
      const currentSelections = getSelections();
      console.log('üìä Selections:', currentSelections);
      
      // TEMPORARY: Bypass paywall check for debugging
      // Check if user can configure
      let canUse = true;
      try {
        canUse = canConfigure();
        console.log('‚úÖ canConfigure:', canUse);
      } catch (error) {
        console.error('‚ùå Error in canConfigure:', error);
        canUse = true; // Allow anyway for debugging
      }
      
      if (!canUse) {
        console.log('üîí Showing paywall...');
        showPaywall();
        return;
      }
      
      console.log('‚úÖ Generating recommendations...');
      
      // Defaults (fallback if DB not loaded)
      let racquet = { brand: 'Babolat', name: 'Pure Drive', category: 'Polyvalent', weight: '300g', head: '100 sq in', stiffness: 72, stiffnessDisplay: 'RA 72', price: '269‚Ç¨', reason: 'Raquette polyvalente id√©ale pour progresser.', stringStiffness: 240 };
      let string = { brand: 'Babolat', name: 'RPM Blast', type: 'Polyester', spin: '10/10', control: '8/10', comfort: '5/10', price: '18‚Ç¨', reason: 'Excellent pour g√©n√©rer du spin.', stiffness: 240 };
      let tension = { value: '23-25 kg', numValue: 24, reason: 'Tension moyenne pour √©quilibre puissance/contr√¥le.' };
      let rcsProfile = null;
      
      let racquetCriteria = {};
      let stringCriteria = {};

      // PRIORITY 1: Adjust for LEVEL (d√©butant needs confort!)
      if (selections.level === 'debutant') {
        racquetCriteria = {
          level: 'Beginner',
          category: ['Light', 'Tweener'],
          maxStiffness: 66,
          preferComfort: true,
          preferLightweight: true
        };
        stringCriteria = {
          types: ['Multifilament', 'Natural Gut'],
          preferComfort: true
        };
        tension = { value: '20-22 kg', numValue: 21, reason: 'Tension basse pour maximiser le confort et la puissance.' };
        rcsProfile = 'debutant';
        
        const dbRacquet = pickBestRacquet(racquetCriteria);
        const dbString = pickBestString(stringCriteria);
        
        if (dbRacquet) {
          racquet = {
            brand: dbRacquet.brand,
            name: dbRacquet.model,
            category: dbRacquet.category || 'Confort',
            weight: `${dbRacquet.weight}g`,
            head: `${dbRacquet.head_size} sq in`,
            stiffness: dbRacquet.stiffness || 55,
            stiffnessDisplay: `RA ${dbRacquet.stiffness || 55}`,
            price: `${dbRacquet.price_eur}‚Ç¨`,
            reason: 'Raquette flexible et confortable, id√©ale pour d√©buter sans forcer.'
          };
        } else {
          // Fallback
          racquet = { brand: 'Wilson', name: 'Clash 100', category: 'Confort', weight: '295g', head: '100 sq in', stiffness: 55, stiffnessDisplay: 'RA 55', price: '249‚Ç¨', reason: 'Raquette tr√®s flexible et confortable, id√©ale pour d√©buter sans forcer.' };
        }
        
        if (dbString) {
          string = {
            brand: dbString.brand,
            name: dbString.model,
            type: dbString.type,
            spin: `${dbString.spin || 6}/10`,
            control: `${dbString.control || 7}/10`,
            comfort: `${dbString.comfort || 9}/10`,
            price: `${dbString.price_eur}‚Ç¨`,
            reason: 'Cordage doux qui prot√®ge le bras et offre de la puissance.',
            stiffness: dbString.stiffness || 150
          };
        } else {
          string = { brand: 'Tecnifibre', name: 'NRG2', type: 'Multifilament', spin: '6/10', control: '7/10', comfort: '10/10', price: '16‚Ç¨', reason: 'Multifilament doux qui prot√®ge le bras et offre de la puissance.', stiffness: 145 };
        }
      } else if (selections.level === 'intermediaire') {
        racquetCriteria = {
          level: 'Intermediate',
          category: ['Tweener', 'Modern Player'],
          maxStiffness: 67,
          minStiffness: 60
        };
        stringCriteria = {
          types: ['Multifilament', 'Hybrid'],
          preferComfort: true
        };
        tension = { value: '22-24 kg', numValue: 23, reason: 'Tension mod√©r√©e pour confort et contr√¥le.' };
        rcsProfile = 'club';
        
        const dbRacquet = pickBestRacquet(racquetCriteria);
        const dbString = pickBestString(stringCriteria);
        
        if (dbRacquet) {
          racquet = {
            brand: dbRacquet.brand,
            name: dbRacquet.model,
            category: dbRacquet.category || 'Polyvalent',
            weight: `${dbRacquet.weight}g`,
            head: `${dbRacquet.head_size} sq in`,
            stiffness: dbRacquet.stiffness || 62,
            stiffnessDisplay: `RA ${dbRacquet.stiffness || 62}`,
            price: `${dbRacquet.price_eur}‚Ç¨`,
            reason: 'Raquette √©quilibr√©e pour joueur en progression.'
          };
        } else {
          racquet = { brand: 'Head', name: 'Speed MP', category: 'Polyvalent', weight: '300g', head: '100 sq in', stiffness: 62, stiffnessDisplay: 'RA 62', price: '259‚Ç¨', reason: 'Raquette √©quilibr√©e pour joueur en progression.' };
        }
        
        if (dbString) {
          string = {
            brand: dbString.brand,
            name: dbString.model,
            type: dbString.type,
            spin: `${dbString.spin || 7}/10`,
            control: `${dbString.control || 7}/10`,
            comfort: `${dbString.comfort || 8}/10`,
            price: `${dbString.price_eur}‚Ç¨`,
            reason: 'Cordage confortable avec bon retour d\'√©nergie.',
            stiffness: dbString.stiffness || 160
          };
        } else {
          string = { brand: 'Wilson', name: 'NXT', type: 'Multifilament', spin: '6/10', control: '7/10', comfort: '9/10', price: '22‚Ç¨', reason: 'Multifilament confortable avec bon retour d\'√©nergie.', stiffness: 155 };
        }
      }

      // PRIORITY 2: Adjust for physical issues (OVERRIDES level for safety)
      if (selections.physical === 'bras' || selections.physical === 'epaule') {
        racquetCriteria = {
          level: selections.level === 'debutant' ? 'Beginner' : 'Intermediate',
          category: ['Tweener', 'Light'],
          maxStiffness: 64,
          preferComfort: true
        };
        stringCriteria = {
          types: ['Multifilament', 'Natural Gut'],
          preferComfort: true
        };
        tension = { value: '21-23 kg', numValue: 22, reason: 'Tension basse pour plus de confort et moins de vibrations.' };
        rcsProfile = 'tennis_elbow';
        
        const dbRacquet = pickBestRacquet(racquetCriteria);
        const dbString = pickBestString(stringCriteria);
        
        if (dbRacquet) {
          racquet = {
            brand: dbRacquet.brand,
            name: dbRacquet.model,
            category: dbRacquet.category || 'Confort',
            weight: `${dbRacquet.weight}g`,
            head: `${dbRacquet.head_size} sq in`,
            stiffness: dbRacquet.stiffness || 62,
            stiffnessDisplay: `RA ${dbRacquet.stiffness || 62}`,
            price: `${dbRacquet.price_eur}‚Ç¨`,
            reason: 'Raquette confortable qui absorbe bien les vibrations.'
          };
        } else {
          racquet = { brand: 'Yonex', name: 'EZONE 100', category: 'Confort', weight: '300g', head: '100 sq in', stiffness: 62, stiffnessDisplay: 'RA 62', price: '249‚Ç¨', reason: 'Raquette tr√®s confortable, absorbe bien les vibrations.' };
        }
        
        if (dbString) {
          string = {
            brand: dbString.brand,
            name: dbString.model,
            type: dbString.type,
            spin: `${dbString.spin || 6}/10`,
            control: `${dbString.control || 7}/10`,
            comfort: `${dbString.comfort || 10}/10`,
            price: `${dbString.price_eur}‚Ç¨`,
            reason: 'Cordage ultra-confortable, excellent pour prot√©ger le bras.',
            stiffness: dbString.stiffness || 155
          };
        } else {
          string = { brand: 'Wilson', name: 'NXT', type: 'Multifilament', spin: '6/10', control: '7/10', comfort: '10/10', price: '22‚Ç¨', reason: 'Multifilament ultra-confortable, excellent pour prot√©ger le bras.', stiffness: 155 };
        }
      }
      // PRIORITY 3: Customize based on style (ONLY for advanced/competition players)
      else if (selections.level === 'avance' || selections.level === 'competition') {
        if (selections.style === 'puissance') {
          racquetCriteria = {
            level: selections.level === 'avance' ? 'Advanced' : 'Pro',
            category: ['Power', 'Modern Player'],
            minStiffness: 66
          };
          stringCriteria = {
            types: ['Polyester', 'Co-Polyester'],
            preferControl: true
          };
          tension = { value: '24-26 kg', numValue: 25, reason: 'Tension plus haute pour plus de contr√¥le.' };
          rcsProfile = 'competiteur';
          
          const dbRacquet = pickBestRacquet(racquetCriteria);
          const dbString = pickBestString(stringCriteria);
          
          if (dbRacquet) {
            racquet = {
              brand: dbRacquet.brand,
              name: dbRacquet.model,
              category: dbRacquet.category || 'Puissance',
              weight: `${dbRacquet.weight}g`,
              head: `${dbRacquet.head_size} sq in`,
              stiffness: dbRacquet.stiffness || 70,
              stiffnessDisplay: `RA ${dbRacquet.stiffness || 70}`,
              price: `${dbRacquet.price_eur}‚Ç¨`,
              reason: 'Raquette puissante avec excellent retour d\'√©nergie.'
            };
          } else {
            racquet = { brand: 'Babolat', name: 'Pure Drive', category: 'Puissance', weight: '300g', head: '100 sq in', stiffness: 72, stiffnessDisplay: 'RA 72', price: '269‚Ç¨', reason: 'Raquette puissante avec excellent retour d\'√©nergie.' };
          }
          
          if (dbString) {
            string = {
              brand: dbString.brand,
              name: dbString.model,
              type: dbString.type,
              spin: `${dbString.spin || 8}/10`,
              control: `${dbString.control || 9}/10`,
              comfort: `${dbString.comfort || 6}/10`,
              price: `${dbString.price_eur}‚Ç¨`,
              reason: 'Contr√¥le optimal pour canaliser votre puissance.',
              stiffness: dbString.stiffness || 230
            };
          } else {
            string = { brand: 'Luxilon', name: 'ALU Power', type: 'Polyester', spin: '8/10', control: '9/10', comfort: '6/10', price: '19‚Ç¨', reason: 'Contr√¥le optimal pour canaliser votre puissance.', stiffness: 230 };
          }
        } else if (selections.style === 'controle') {
          racquetCriteria = {
            level: selections.level === 'avance' ? 'Advanced' : 'Pro',
            category: ['Control', 'Classic Player']
          };
          stringCriteria = {
            types: ['Polyester'],
            preferControl: true
          };
          tension = { value: '25-27 kg', numValue: 26, reason: 'Tension haute pour maximiser le contr√¥le.' };
          rcsProfile = 'confirme';
          
          const dbRacquet = pickBestRacquet(racquetCriteria);
          const dbString = pickBestString(stringCriteria);
          
          if (dbRacquet) {
            racquet = {
              brand: dbRacquet.brand,
              name: dbRacquet.model,
              category: dbRacquet.category || 'Contr√¥le',
              weight: `${dbRacquet.weight}g`,
              head: `${dbRacquet.head_size} sq in`,
              stiffness: dbRacquet.stiffness || 63,
              stiffnessDisplay: `RA ${dbRacquet.stiffness || 63}`,
              price: `${dbRacquet.price_eur}‚Ç¨`,
              reason: 'Raquette de contr√¥le pour pr√©cision maximale.'
            };
          } else {
            racquet = { brand: 'Wilson', name: 'Pro Staff 97', category: 'Contr√¥le', weight: '315g', head: '97 sq in', stiffness: 63, stiffnessDisplay: 'RA 63', price: '299‚Ç¨', reason: 'Raquette de contr√¥le ultime, utilis√©e par Federer.' };
          }
          
          if (dbString) {
            string = {
              brand: dbString.brand,
              name: dbString.model,
              type: dbString.type,
              spin: `${dbString.spin || 7}/10`,
              control: `${dbString.control || 9}/10`,
              comfort: `${dbString.comfort || 5}/10`,
              price: `${dbString.price_eur}‚Ç¨`,
              reason: 'Pr√©cision et durabilit√© excellentes.',
              stiffness: dbString.stiffness || 220
            };
          } else {
            string = { brand: 'Head', name: 'Hawk', type: 'Polyester', spin: '7/10', control: '9/10', comfort: '5/10', price: '12‚Ç¨', reason: 'Pr√©cision et durabilit√© excellentes.', stiffness: 215 };
          }
        } else if (selections.style === 'spin') {
          racquetCriteria = {
            level: selections.level === 'avance' ? 'Advanced' : 'Pro',
            category: ['Modern Player', 'Spin']
          };
          stringCriteria = {
            types: ['Polyester', 'Co-Polyester'],
            preferSpin: true
          };
          tension = { value: '23-25 kg', numValue: 24, reason: 'Tension moyenne pour maximiser l\'accroche.' };
          rcsProfile = 'club';
          
          const dbRacquet = pickBestRacquet(racquetCriteria);
          const dbString = pickBestString(stringCriteria);
          
          if (dbRacquet) {
            racquet = {
              brand: dbRacquet.brand,
              name: dbRacquet.model,
              category: dbRacquet.category || 'Spin',
              weight: `${dbRacquet.weight}g`,
              head: `${dbRacquet.head_size} sq in`,
              stiffness: dbRacquet.stiffness || 67,
              stiffnessDisplay: `RA ${dbRacquet.stiffness || 67}`,
              price: `${dbRacquet.price_eur}‚Ç¨`,
              reason: 'Raquette optimis√©e pour g√©n√©rer un maximum de spin.'
            };
          } else {
            racquet = { brand: 'Babolat', name: 'Pure Aero', category: 'Spin', weight: '300g', head: '100 sq in', stiffness: 67, stiffnessDisplay: 'RA 67', price: '279‚Ç¨', reason: 'La raquette de Nadal et Alcaraz, roi du spin.' };
          }
          
          if (dbString) {
            string = {
              brand: dbString.brand,
              name: dbString.model,
              type: dbString.type,
              spin: `${dbString.spin || 10}/10`,
              control: `${dbString.control || 8}/10`,
              comfort: `${dbString.comfort || 5}/10`,
              price: `${dbString.price_eur}‚Ç¨`,
              reason: 'Cordage pour un spin maximum.',
              stiffness: dbString.stiffness || 240
            };
          } else {
            string = { brand: 'Babolat', name: 'RPM Blast', type: 'Polyester', spin: '10/10', control: '8/10', comfort: '5/10', price: '18‚Ç¨', reason: 'Le cordage de Nadal pour un spin maximum.', stiffness: 240 };
          }
        }
      }

      // Update UI - Racquet
      document.getElementById('rec-racquet-brand').textContent = racquet.brand;
      document.getElementById('rec-racquet-name').textContent = racquet.name;
      document.getElementById('rec-racquet-category').textContent = racquet.category;
      document.getElementById('rec-racquet-weight').textContent = racquet.weight;
      document.getElementById('rec-racquet-head').textContent = racquet.head;
      document.getElementById('rec-racquet-stiffness').textContent = racquet.stiffnessDisplay;
      document.getElementById('rec-racquet-price').textContent = racquet.price;
      document.getElementById('rec-racquet-reason').textContent = racquet.reason;

      // Update UI - String
      document.getElementById('rec-string-brand').textContent = string.brand;
      document.getElementById('rec-string-name').textContent = string.name;
      document.getElementById('rec-string-type').textContent = string.type;
      document.getElementById('rec-string-spin').textContent = string.spin;
      document.getElementById('rec-string-control').textContent = string.control;
      document.getElementById('rec-string-comfort').textContent = string.comfort;
      document.getElementById('rec-string-price').textContent = string.price;
      document.getElementById('rec-string-reason').textContent = string.reason;

      // Update UI - Tension
      document.getElementById('rec-tension').textContent = tension.value;
      document.getElementById('rec-tension-reason').textContent = tension.reason;

      // Calculate and display RCS
      updateRCSDisplay(racquet.stiffness, string.stiffness, tension.numValue, rcsProfile);

      // Record usage
      recordConfigurationUsage();

      goToStep(4);
    }

    // Update RCS Display
    function updateRCSDisplay(ra, stringStiffness, tensionKg, profile) {
      if (typeof RCS === 'undefined') {
        console.error('RCS calculator not loaded');
        return;
      }

      const result = RCS.calculate(ra, stringStiffness, tensionKg);
      const { rcs, decile, quintile } = result;

      // Update score display
      document.getElementById('rcs-score-display').textContent = rcs;
      document.getElementById('rcs-score-display').style.background = decile.color;
      document.getElementById('rcs-score-display').style.color = decile.textColor;

      // Update decile label
      document.getElementById('rcs-icon').textContent = decile.icon;
      document.getElementById('rcs-label').textContent = `D${decile.number} - ${decile.label}`;
      document.getElementById('rcs-decile-label').style.background = decile.color;
      document.getElementById('rcs-decile-label').style.color = decile.textColor;

      // Update description
      document.getElementById('rcs-description').textContent = decile.description;

      // Update gauge indicator
      document.getElementById('rcs-indicator').style.marginLeft = `calc(${rcs}% - 10px)`;

      // Update comment box
      const commentBox = document.getElementById('rcs-comment');
      commentBox.style.background = decile.color + '20';
      commentBox.style.borderLeftColor = decile.color;
      
      // Generate advice based on RCS
      let advice = '';
      if (rcs < 30) {
        advice = 'Configuration tr√®s confortable. Excellente pour pr√©server vos articulations.';
      } else if (rcs < 50) {
        advice = 'Configuration √©quilibr√©e, adapt√©e √† la plupart des joueurs de club.';
      } else if (rcs < 70) {
        advice = 'Configuration dynamique. Assurez-vous d\'avoir une bonne condition physique.';
      } else {
        advice = '‚ö†Ô∏è Configuration exigeante. √âchauffement rigoureux recommand√©.';
      }
      document.getElementById('rcs-advice').textContent = advice;

      // Profile evaluation if applicable
      if (profile) {
        const evaluation = RCS.evaluateForProfile(rcs, profile);
        const evalContainer = document.getElementById('rcs-profile-eval');
        evalContainer.classList.remove('hidden');
        
        const statusColors = {
          'optimal': { bg: 'bg-green-50', border: 'border-green-300', text: 'text-green-800' },
          'trop_souple': { bg: 'bg-blue-50', border: 'border-blue-300', text: 'text-blue-800' },
          'trop_rigide': { bg: 'bg-red-50', border: 'border-red-300', text: 'text-red-800' }
        };
        const colors = statusColors[evaluation.status] || statusColors['optimal'];
        
        evalContainer.className = `mt-4 p-4 rounded-lg border-2 ${colors.bg} ${colors.border}`;
        document.getElementById('rcs-eval-icon').textContent = evaluation.icon;
        document.getElementById('rcs-eval-message').textContent = evaluation.message;
        document.getElementById('rcs-eval-message').className = `font-semibold ${colors.text}`;
        document.getElementById('rcs-eval-suggestion').textContent = evaluation.suggestion || '';
        document.getElementById('rcs-eval-suggestion').className = `mt-2 text-sm ${colors.text} opacity-80`;
      } else {
        document.getElementById('rcs-profile-eval').classList.add('hidden');
      }
    }

    // Check auth state for nav
    async function checkAuthForNav() {
      try {
        const SUPABASE_URL = 'https://yhhdkllbaxuhwrfpsmev.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InloaGRrbGxiYXh1aHdyZnBzbWV2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU3NjI0MDEsImV4cCI6MjA4MTMzODQwMX0.2aC_gYZf0xxz6MXi5zcaCH2S64RBaQvXU7a5qiuD0_k';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        const { data: { session } } = await supabase.auth.getSession();
        const authLink = document.getElementById('authLink');
        if (session) {
          authLink.href = '/account.html';
          authLink.innerHTML = 'üë§ Mon Compte';
        } else {
          authLink.href = '/auth.html';
          authLink.innerHTML = 'üë§ Connexion';
        }
      } catch (e) { console.log('Auth check skipped'); }
    }
    checkAuthForNav();

    // Restart
    function restartConfigurator() {
      // Uncheck all radio buttons
      document.querySelectorAll('input[type="radio"].option-input').forEach(radio => {
        radio.checked = false;
      });
      goToStep(1);
    }

    // SOLUTION 10: Ultra-simple form handler
    function handleGenerate() {
      console.log('üöÄ handleGenerate() called from form onsubmit');
      try {
        generateResult();
      } catch (error) {
        console.error('‚ùå Error in generateResult:', error);
        alert('Erreur: ' + error.message);
      }
      return false; // Prevent form submission
    }
    
    // Make functions globally accessible
    window.goToStep = goToStep;
    window.restartConfigurator = restartConfigurator;
    window.generateResult = generateResult;
    window.getSelections = getSelections;
    window.handleGenerate = handleGenerate;
    
    // =====================================================
    // SOLUTION 8: SIMPLE EVENT HANDLING FOR NAV BUTTONS
    // =====================================================
    // Radio buttons handle themselves - we only need nav
    
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üöÄ Configurator v8 (Native Radio Buttons) initializing...');
      
      // Initialize step 1
      goToStep(1);
      
      // SOLUTION 10: Use FORM submit instead of button click
      // Forms are harder for external scripts to intercept
      const generateForm = document.getElementById('generateForm');
      if (generateForm) {
        generateForm.addEventListener('submit', function(e) {
          console.log('üéâ Generate FORM submitted (capture phase)');
          e.stopPropagation();
          e.stopImmediatePropagation();
          e.preventDefault();
          generateResult();
          return false;
        }, { capture: true }); // Execute in capture phase
        console.log('‚úÖ Generate FORM listener attached with capture:true');
      }
      
      // Fallback: Also listen on button directly
      const generateBtn = document.getElementById('generateBtn');
      if (generateBtn) {
        generateBtn.addEventListener('click', function(e) {
          console.log('üéâ Generate button clicked (capture phase - fallback)');
          e.stopPropagation();
          e.stopImmediatePropagation();
          e.preventDefault();
          generateResult();
          return false;
        }, { capture: true });
        console.log('‚úÖ Generate button listener attached (fallback)');
      }
      
      console.log('‚úÖ Configurator v8 ready!');
      console.log('üìã Total radio inputs:', document.querySelectorAll('input[type="radio"]').length);
      console.log('üîò Navigation uses onclick attributes (immune to external scripts)');
    });
  </script>
</body>
</html>
