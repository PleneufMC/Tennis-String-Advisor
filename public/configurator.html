<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Configurateur expert Tennis String Advisor. Trouvez votre setup idÃ©al raquette + cordage + tension en quelques clics. Recommandations personnalisÃ©es selon votre niveau et style.">
  <meta name="keywords" content="configurateur tennis, setup, raquette, cordage, tension, recommandation personnalisÃ©e">
  <meta property="og:title" content="Configurateur Expert - Tennis String Advisor">
  <meta property="og:description" content="Trouvez votre setup tennis parfait en quelques clics. Recommandations personnalisÃ©es.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://tennisstringadvisor.org/configurator.html">
  <link rel="canonical" href="https://tennisstringadvisor.org/configurator.html">
  <link rel="alternate" hreflang="fr" href="https://tennisstringadvisor.org/configurator.html">
  <link rel="alternate" hreflang="en" href="https://tennisstringadvisor.org/en/configurator.html">
  <link rel="alternate" hreflang="x-default" href="https://tennisstringadvisor.org/configurator.html">
  <title>Configurateur Expert - Tennis String Advisor</title>
  
  <!-- Schema.org WebApplication -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Tennis String Advisor Configurateur",
    "description": "Configurateur expert pour trouver votre setup tennis idÃ©al (raquette, cordage, tension)",
    "url": "https://tennisstringadvisor.org/configurator.html",
    "applicationCategory": "SportsApplication",
    "operatingSystem": "Web Browser",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "EUR",
      "description": "2 configurations gratuites, puis Premium Ã  19,99â‚¬ Ã  vie"
    },
    "featureList": [
      "Recommandations de raquettes personnalisÃ©es",
      "Recommandations de cordages personnalisÃ©es",
      "Calcul de tension optimale",
      "Score RCS (Confort Articulaire)"
    ]
  }
  </script>
  
  <!-- Schema.org BreadcrumbList -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Accueil",
        "item": "https://tennisstringadvisor.org/"
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": "Configurateur",
        "item": "https://tennisstringadvisor.org/configurator.html"
      }
    ]
  }
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- DEFER external scripts to prevent interference with event listeners -->
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script defer src="/js/rcs-calculator.js"></script>
  <link rel="stylesheet" href="/css/dark-mode.css">
  <script src="/js/theme.js"></script>
  <style>
    .animate-fade-in { animation: fadeIn 0.3s ease-in; }
    @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
  </style>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            tennis: { green: '#16a34a', dark: '#0d1117', light: '#f0fdf4' }
          }
        }
      },
      darkMode: 'class'
    }
  </script>
  <style>
    .step-active { background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%); }
    .step-completed { background: #16a34a; }
    .step-pending { background: #e5e7eb; }
    
    /* SOLUTION 8: Radio button approach - immune to external scripts */
    input[type="radio"].option-input { 
      position: absolute;
      opacity: 0;
      pointer-events: none;
    }
    
    .option-card { 
      transition: all 0.2s ease;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
      -webkit-user-select: none;
      cursor: pointer;
    }
    
    .option-card:hover { 
      border-color: #16a34a; 
      transform: translateY(-2px); 
    }
    
    .option-card:active { 
      transform: scale(0.98); 
    }
    
    /* Selected state via :checked pseudo-class */
    input[type="radio"].option-input:checked + .option-card { 
      border-color: #16a34a !important; 
      background: #f0fdf4 !important; 
    }
  </style>
  <!-- Google Analytics 4 - Load AFTER page interactions setup -->
  <script defer src="https://www.googletagmanager.com/gtag/js?id=G-YSSLHJ5WYD"></script>
  <script defer src="/js/analytics.js"></script>
</head>
<body class="bg-gray-50 min-h-screen">
  <!-- Premium Paywall Modal -->
  <div id="configuratorPaywall" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] hidden items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full overflow-hidden animate-fade-in">
      <div class="bg-gradient-to-r from-amber-500 to-orange-500 p-6 text-white text-center">
        <span class="text-5xl block mb-3">ğŸ”’</span>
        <h2 class="text-2xl font-bold">Essai Gratuit UtilisÃ©</h2>
        <p class="text-white/90 mt-2">Vous avez utilisÃ© votre configuration gratuite</p>
      </div>
      <div class="p-6">
        <div class="bg-green-50 border border-green-200 rounded-xl p-4 mb-6">
          <h3 class="font-semibold text-green-800 flex items-center gap-2">
            <span>âœ¨</span> Passez Premium pour continuer
          </h3>
          <ul class="mt-3 space-y-2 text-sm text-green-700">
            <li class="flex items-center gap-2"><span>âœ“</span> Configurations illimitÃ©es</li>
            <li class="flex items-center gap-2"><span>âœ“</span> Calculs RCS illimitÃ©s</li>
            <li class="flex items-center gap-2"><span>âœ“</span> Sauvegarde de vos setups</li>
            <li class="flex items-center gap-2"><span>âœ“</span> Journal de cordage</li>
            <li class="flex items-center gap-2"><span>âœ“</span> Alertes prix</li>
            <li class="flex items-center gap-2"><span>âœ“</span> Export PDF</li>
          </ul>
        </div>
        <div class="text-center mb-4">
          <span class="text-3xl font-bold text-gray-900">19,99â‚¬</span>
          <span class="text-gray-600 ml-1">une seule fois</span>
          <p class="text-sm text-green-600 font-medium mt-1">ğŸ‰ AccÃ¨s Ã  vie - Pas d'abonnement !</p>
        </div>
        <div class="space-y-3">
          <a href="/premium.html" class="block w-full py-3 px-6 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold rounded-xl text-center hover:from-amber-600 hover:to-orange-600 transition shadow-lg">
            âœ¨ Devenir Premium
          </a>
          <a href="/auth.html" id="paywallAuthLink" class="block w-full py-3 px-6 border-2 border-gray-300 text-gray-700 font-medium rounded-xl text-center hover:bg-gray-50 transition">
            CrÃ©er un compte gratuit
          </a>
          <a href="/auth.html?mode=login" class="block w-full py-2 px-6 text-green-600 font-medium text-center hover:text-green-700 hover:underline transition">
            ğŸ”‘ DÃ©jÃ  membre ? Se connecter
          </a>
        </div>
        <p class="text-xs text-gray-500 text-center mt-4">
          Le compte gratuit inclut 2 configurations. Premium = illimitÃ© Ã  vie.
        </p>
      </div>
    </div>
  </div>

  <!-- Free Trial Banner -->
  <div id="freeTrialBanner" class="hidden bg-gradient-to-r from-green-500 to-green-600 text-white py-3 px-4 text-center">
    <span class="font-medium">ğŸ Essai gratuit : <span id="remainingConfigurations">2</span> configuration(s) restante(s)</span>
    <span class="mx-2">|</span>
    <a href="/premium.html" class="underline font-semibold hover:text-green-100">Premium Ã  vie pour 19,99â‚¬ â†’</a>
  </div>

  <!-- Premium Banner -->
  <div id="premiumBanner" class="hidden bg-gradient-to-r from-amber-500 to-orange-500 text-white py-2 px-4 text-center">
    <span class="font-medium">âœ¨ Membre Premium - Configurations illimitÃ©es</span>
  </div>
  <!-- Header -->
  <header class="bg-white border-b border-gray-200 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 py-4">
      <div class="flex items-center justify-between">
        <a href="/" class="flex items-center gap-2">
          <span class="text-2xl">ğŸ¾</span>
          <span class="font-bold text-xl text-gray-900">Tennis String Advisor</span>
        </a>
        <nav class="hidden md:flex items-center gap-6">
          <a href="/" class="text-gray-600 hover:text-green-600 transition">Accueil</a>
          <a href="/configurator.html" class="text-green-600 font-semibold">Configurateur</a>
          <a href="/racquets.html" class="text-gray-600 hover:text-green-600 transition">Raquettes</a>
          <a href="/strings.html" class="text-gray-600 hover:text-green-600 transition">Cordages</a>
          <a href="/compare.html" class="text-gray-600 hover:text-green-600 transition">Comparateur</a>
          <a href="/rcs-calculator.html" class="text-gray-600 hover:text-green-600 transition">ğŸ©º RCS</a>
        </nav>
        <div class="flex items-center gap-3">
          <!-- Language Selector (desktop) -->
          <a href="/en/configurator.html" class="hidden md:flex items-center gap-1 px-3 py-2 text-sm font-medium text-gray-600 hover:bg-gray-100 rounded-lg transition" title="English version">
            ğŸ‡¬ğŸ‡§ EN
          </a>
          <button onclick="toggleDarkMode()" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition" aria-label="Toggle dark mode">
            <span class="theme-icon text-xl">ğŸŒ™</span>
          </button>
          <a href="/auth.html" id="authLink" class="hidden md:flex items-center gap-2 px-4 py-2 text-sm font-medium text-green-600 hover:bg-green-50 dark:text-green-400 dark:hover:bg-gray-700 rounded-lg transition">
            ğŸ‘¤ Mon Compte
          </a>
          <!-- Mobile menu button -->
          <button class="md:hidden p-2 rounded-lg hover:bg-gray-100" onclick="document.getElementById('mobileMenu').classList.toggle('hidden')">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>
        </div>
      </div>
      <!-- Mobile menu -->
      <div id="mobileMenu" class="hidden md:hidden pb-4 px-4">
        <div class="flex flex-col space-y-2 pt-2 border-t border-gray-200">
          <a href="/" class="px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100">Accueil</a>
          <a href="/configurator.html" class="px-4 py-2 text-sm font-medium rounded-lg bg-green-100 text-green-700">Configurateur</a>
          <a href="/racquets.html" class="px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100">Raquettes</a>
          <a href="/strings.html" class="px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100">Cordages</a>
          <a href="/compare.html" class="px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100">Comparateur</a>
          <a href="/rcs-calculator.html" class="px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100">ğŸ©º RCS</a>
          <a href="/auth.html" class="px-4 py-2 text-sm font-medium text-green-600 hover:bg-green-50 rounded-lg">ğŸ‘¤ Mon Compte</a>
          <div class="border-t border-gray-200 my-2"></div>
          <a href="/en/configurator.html" class="px-4 py-2 text-sm font-medium rounded-lg text-blue-600 hover:bg-blue-50 flex items-center gap-2">
            ğŸ‡¬ğŸ‡§ English Version
          </a>
        </div>
      </div>
    </div>
  </header>

  <!-- Breadcrumbs -->
  <nav class="bg-gray-100 dark:bg-gray-800 py-3 border-b border-gray-200 dark:border-gray-700">
    <div class="max-w-4xl mx-auto px-4">
      <ol class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
        <li><a href="/" class="hover:text-green-600 dark:hover:text-green-400">Accueil</a></li>
        <li><span class="mx-2">/</span></li>
        <li class="text-gray-900 dark:text-white font-medium">Configurateur</li>
      </ol>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="max-w-4xl mx-auto px-4 py-8">
    <!-- Page Header -->
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold text-gray-900 mb-2">Configurateur Expert 2025</h1>
      <p class="text-gray-600">Trouvez le setup parfait adaptÃ© Ã  votre style de jeu en quelques Ã©tapes</p>
    </div>

    <!-- Progress Steps -->
    <div class="flex justify-center items-center gap-4 mb-12">
      <div class="flex items-center gap-2">
        <div class="w-10 h-10 rounded-full flex items-center justify-center text-white font-bold step-active" id="step1-indicator">1</div>
        <span class="text-sm font-medium text-gray-700">Profil</span>
      </div>
      <div class="w-16 h-1 bg-gray-200 rounded" id="progress1"></div>
      <div class="flex items-center gap-2">
        <div class="w-10 h-10 rounded-full flex items-center justify-center text-gray-500 font-bold step-pending" id="step2-indicator">2</div>
        <span class="text-sm font-medium text-gray-500">Style</span>
      </div>
      <div class="w-16 h-1 bg-gray-200 rounded" id="progress2"></div>
      <div class="flex items-center gap-2">
        <div class="w-10 h-10 rounded-full flex items-center justify-center text-gray-500 font-bold step-pending" id="step3-indicator">3</div>
        <span class="text-sm font-medium text-gray-500">Budget</span>
      </div>
      <div class="w-16 h-1 bg-gray-200 rounded" id="progress3"></div>
      <div class="flex items-center gap-2">
        <div class="w-10 h-10 rounded-full flex items-center justify-center text-gray-500 font-bold step-pending" id="step4-indicator">4</div>
        <span class="text-sm font-medium text-gray-500">RÃ©sultat</span>
      </div>
    </div>

    <!-- Step 1: Player Profile -->
    <div id="step1" class="bg-white rounded-xl shadow-sm border border-gray-200 p-8">
      <h2 class="text-xl font-bold text-gray-900 mb-6">Quel est votre niveau de jeu ?</h2>
      
      <div id="level-group" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
        <div>
          <input type="radio" name="level" id="level-debutant" value="debutant" class="option-input">
          <label for="level-debutant" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">
            <div class="text-3xl mb-3">ğŸŒ±</div>
            <h3 class="font-semibold text-gray-900 mb-1">DÃ©butant</h3>
            <p class="text-sm text-gray-500">Moins de 2 ans de pratique, apprentissage des bases</p>
          </label>
        </div>
        <div>
          <input type="radio" name="level" id="level-intermediaire" value="intermediaire" class="option-input">
          <label for="level-intermediaire" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">
            <div class="text-3xl mb-3">ğŸ“ˆ</div>
            <h3 class="font-semibold text-gray-900 mb-1">IntermÃ©diaire</h3>
            <p class="text-sm text-gray-500">2-5 ans de pratique, technique en progression</p>
          </label>
        </div>
        <div>
          <input type="radio" name="level" id="level-avance" value="avance" class="option-input">
          <label for="level-avance" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">
            <div class="text-3xl mb-3">â­</div>
            <h3 class="font-semibold text-gray-900 mb-1">AvancÃ©</h3>
            <p class="text-sm text-gray-500">5+ ans de pratique, maÃ®trise technique</p>
          </label>
        </div>
        <div>
          <input type="radio" name="level" id="level-competition" value="competition" class="option-input">
          <label for="level-competition" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">
            <div class="text-3xl mb-3">ğŸ†</div>
            <h3 class="font-semibold text-gray-900 mb-1">CompÃ©tition</h3>
            <p class="text-sm text-gray-500">Joueur classÃ©, entraÃ®nement rÃ©gulier intensif</p>
          </label>
        </div>
      </div>

      <h2 class="text-xl font-bold text-gray-900 mb-6">Ã€ quelle frÃ©quence jouez-vous ?</h2>
      
      <div id="frequency-group" class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <input type="radio" name="frequency" id="frequency-occasionnel" value="occasionnel" class="option-input">
          <label for="frequency-occasionnel" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">
            <div class="text-3xl mb-3">ğŸ¾</div>
            <h3 class="font-semibold text-gray-900 mb-1">Occasionnel</h3>
            <p class="text-sm text-gray-500">1-2 fois par mois</p>
          </label>
        </div>
        <div>
          <input type="radio" name="frequency" id="frequency-regulier" value="regulier" class="option-input">
          <label for="frequency-regulier" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">
            <div class="text-3xl mb-3">ğŸ“…</div>
            <h3 class="font-semibold text-gray-900 mb-1">RÃ©gulier</h3>
            <p class="text-sm text-gray-500">1-2 fois par semaine</p>
          </label>
        </div>
        <div>
          <input type="radio" name="frequency" id="frequency-intensif" value="intensif" class="option-input">
          <label for="frequency-intensif" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">
            <div class="text-3xl mb-3">ğŸ”¥</div>
            <h3 class="font-semibold text-gray-900 mb-1">Intensif</h3>
            <p class="text-sm text-gray-500">3+ fois par semaine</p>
          </label>
        </div>
      </div>

      <div class="flex justify-end mt-8">
        <button id="nextStep1" onclick="goToStep(2); return false;" class="px-6 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition">
          Suivant â†’
        </button>
      </div>
    </div>

    <!-- Step 2: Playing Style -->
    <div id="step2" class="bg-white rounded-xl shadow-sm border border-gray-200 p-8 hidden">
      <h2 class="text-xl font-bold text-gray-900 mb-6">Quel est votre style de jeu ?</h2>
      
      <div id="style-group" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
        <div>

          <input type="radio" name="style" id="style_puissance" value="puissance" class="option-input">

          <label for="style_puissance" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">

            <div class="text-3xl mb-3">ğŸ’¥

          </label>

        </div>
          <h3 class="font-semibold text-gray-900 mb-1">Puissance</h3>
          <p class="text-sm text-gray-500">Frappes lourdes, service puissant, jeu agressif</p>
        </div>
        <div>

          <input type="radio" name="style" id="style_controle" value="controle" class="option-input">

          <label for="style_controle" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">

            <div class="text-3xl mb-3">ğŸ¯

          </label>

        </div>
          <h3 class="font-semibold text-gray-900 mb-1">ContrÃ´le</h3>
          <p class="text-sm text-gray-500">PrÃ©cision, placement, construction du point</p>
        </div>
        <div>

          <input type="radio" name="style" id="style_spin" value="spin" class="option-input">

          <label for="style_spin" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">

            <div class="text-3xl mb-3">ğŸŒ€

          </label>

        </div>
          <h3 class="font-semibold text-gray-900 mb-1">Spin / LiftÃ©</h3>
          <p class="text-sm text-gray-500">Effets importants, jeu en fond de court</p>
        </div>
        <div>

          <input type="radio" name="style" id="style_polyvalent" value="polyvalent" class="option-input">

          <label for="style_polyvalent" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">

            <div class="text-3xl mb-3">âš–ï¸

          </label>

        </div>
          <h3 class="font-semibold text-gray-900 mb-1">Polyvalent</h3>
          <p class="text-sm text-gray-500">Ã‰quilibrÃ©, adaptable Ã  toutes les situations</p>
        </div>
      </div>

      <h2 class="text-xl font-bold text-gray-900 mb-6">Avez-vous des problÃ¨mes physiques ?</h2>
      
      <div id="physical-group" class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>

          <input type="radio" name="physical" id="physical_aucun" value="aucun" class="option-input">

          <label for="physical_aucun" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">

            <div class="text-3xl mb-3">ğŸ’ª

          </label>

        </div>
          <h3 class="font-semibold text-gray-900 mb-1">Aucun</h3>
          <p class="text-sm text-gray-500">Pas de problÃ¨me particulier</p>
        </div>
        <div>

          <input type="radio" name="physical" id="physical_bras" value="bras" class="option-input">

          <label for="physical_bras" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">

            <div class="text-3xl mb-3">ğŸ¦¾

          </label>

        </div>
          <h3 class="font-semibold text-gray-900 mb-1">Bras sensible</h3>
          <p class="text-sm text-gray-500">Tennis elbow, douleurs au coude</p>
        </div>
        <div>

          <input type="radio" name="physical" id="physical_epaule" value="epaule" class="option-input">

          <label for="physical_epaule" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">

            <div class="text-3xl mb-3">ğŸ©¹

          </label>

        </div>
          <h3 class="font-semibold text-gray-900 mb-1">Ã‰paule fragile</h3>
          <p class="text-sm text-gray-500">Douleurs Ã  l'Ã©paule</p>
        </div>
      </div>

      <div class="flex justify-between mt-8">
        <button id="prevStep2" onclick="goToStep(1); return false;" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition">
          â† PrÃ©cÃ©dent
        </button>
        <button id="nextStep2" onclick="goToStep(3); return false;" class="px-6 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition">
          Suivant â†’
        </button>
      </div>
    </div>

    <!-- Step 3: Budget -->
    <div id="step3" class="bg-white rounded-xl shadow-sm border border-gray-200 p-8 hidden">
      <h2 class="text-xl font-bold text-gray-900 mb-6">Quel est votre budget pour la raquette ?</h2>
      
      <div id="budget-racquet-group" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
        <div>

          <input type="radio" name="budget-racquet" id="budget-racquet_eco" value="eco" class="option-input">

          <label for="budget-racquet_eco" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">

            <div class="text-3xl mb-3">ğŸ’°

          </label>

        </div>
          <h3 class="font-semibold text-gray-900 mb-1">Ã‰conomique</h3>
          <p class="text-sm text-gray-500">Moins de 150â‚¬</p>
        </div>
        <div>

          <input type="radio" name="budget-racquet" id="budget-racquet_medium" value="medium" class="option-input">

          <label for="budget-racquet_medium" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">

            <div class="text-3xl mb-3">ğŸ’°ğŸ’°

          </label>

        </div>
          <h3 class="font-semibold text-gray-900 mb-1">Moyen</h3>
          <p class="text-sm text-gray-500">150â‚¬ - 250â‚¬</p>
        </div>
        <div>

          <input type="radio" name="budget-racquet" id="budget-racquet_premium" value="premium" class="option-input">

          <label for="budget-racquet_premium" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">

            <div class="text-3xl mb-3">ğŸ’

          </label>

        </div>
          <h3 class="font-semibold text-gray-900 mb-1">Premium</h3>
          <p class="text-sm text-gray-500">Plus de 250â‚¬</p>
        </div>
      </div>

      <h2 class="text-xl font-bold text-gray-900 mb-6">Quel est votre budget pour le cordage ?</h2>
      
      <div id="budget-string-group" class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>

          <input type="radio" name="budget-string" id="budget-string_eco" value="eco" class="option-input">

          <label for="budget-string_eco" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">

            <div class="text-3xl mb-3">ğŸ§µ

          </label>

        </div>
          <h3 class="font-semibold text-gray-900 mb-1">Ã‰conomique</h3>
          <p class="text-sm text-gray-500">Moins de 15â‚¬</p>
        </div>
        <div>

          <input type="radio" name="budget-string" id="budget-string_medium" value="medium" class="option-input">

          <label for="budget-string_medium" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">

            <div class="text-3xl mb-3">ğŸ§¶

          </label>

        </div>
          <h3 class="font-semibold text-gray-900 mb-1">Moyen</h3>
          <p class="text-sm text-gray-500">15â‚¬ - 25â‚¬</p>
        </div>
        <div>

          <input type="radio" name="budget-string" id="budget-string_premium" value="premium" class="option-input">

          <label for="budget-string_premium" class="option-card border-2 border-gray-200 rounded-xl p-6 cursor-pointer block">

            <div class="text-3xl mb-3">âœ¨

          </label>

        </div>
          <h3 class="font-semibold text-gray-900 mb-1">Premium</h3>
          <p class="text-sm text-gray-500">Plus de 25â‚¬</p>
        </div>
      </div>

      <div class="flex justify-between mt-8">
        <button id="prevStep3" type="button" onclick="goToStep(2); return false;" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition">
          â† PrÃ©cÃ©dent
        </button>
        <form id="generateForm" onsubmit="return handleGenerate();" style="display: inline;">
          <button 
            id="generateBtn" 
            type="submit" 
            class="px-6 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition" 
            ontouchstart=""
            ontouchend="handleGenerate(); return false;">
            Voir mes recommandations ğŸ‰
          </button>
        </form>
      </div>
    </div>

    <!-- Step 4: Results -->
    <div id="step4" class="hidden">
      <div class="bg-gradient-to-r from-green-600 to-green-500 rounded-xl p-8 text-white mb-8">
        <h2 class="text-2xl font-bold mb-2">ğŸ‰ Votre Setup PersonnalisÃ©</h2>
        <p class="opacity-90">BasÃ© sur votre profil et vos prÃ©fÃ©rences</p>
      </div>

      <!-- Recommended Racquet -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
        <div class="flex items-center gap-2 mb-4">
          <span class="text-2xl">ğŸ¾</span>
          <h3 class="text-xl font-bold text-gray-900">Raquette RecommandÃ©e</h3>
        </div>
        
        <div class="bg-gray-50 rounded-lg p-6" id="recommended-racquet">
          <div class="flex justify-between items-start">
            <div>
              <span class="text-sm text-green-600 font-medium" id="rec-racquet-brand">Babolat</span>
              <h4 class="text-lg font-bold text-gray-900" id="rec-racquet-name">Pure Drive</h4>
            </div>
            <span class="bg-green-100 text-green-800 text-sm font-medium px-3 py-1 rounded-full" id="rec-racquet-category">Polyvalent</span>
          </div>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">
            <div>
              <span class="text-sm text-gray-500">Poids</span>
              <p class="font-semibold" id="rec-racquet-weight">300g</p>
            </div>
            <div>
              <span class="text-sm text-gray-500">TÃªte</span>
              <p class="font-semibold" id="rec-racquet-head">100 sq in</p>
            </div>
            <div>
              <span class="text-sm text-gray-500">RigiditÃ©</span>
              <p class="font-semibold" id="rec-racquet-stiffness">RA 72</p>
            </div>
            <div>
              <span class="text-sm text-gray-500">Prix</span>
              <p class="font-semibold text-green-600" id="rec-racquet-price">269â‚¬</p>
            </div>
          </div>
          <p class="text-gray-600 mt-4" id="rec-racquet-reason">IdÃ©ale pour les joueurs recherchant polyvalence et puissance.</p>
        </div>
      </div>

      <!-- Recommended String -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
        <div class="flex items-center gap-2 mb-4">
          <span class="text-2xl">ğŸ§µ</span>
          <h3 class="text-xl font-bold text-gray-900">Cordage RecommandÃ©</h3>
        </div>
        
        <div class="bg-gray-50 rounded-lg p-6" id="recommended-string">
          <div class="flex justify-between items-start">
            <div>
              <span class="text-sm text-blue-600 font-medium" id="rec-string-brand">Babolat</span>
              <h4 class="text-lg font-bold text-gray-900" id="rec-string-name">RPM Blast</h4>
            </div>
            <span class="bg-purple-100 text-purple-800 text-sm font-medium px-3 py-1 rounded-full" id="rec-string-type">Polyester</span>
          </div>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">
            <div>
              <span class="text-sm text-gray-500">Spin</span>
              <p class="font-semibold" id="rec-string-spin">10/10</p>
            </div>
            <div>
              <span class="text-sm text-gray-500">ContrÃ´le</span>
              <p class="font-semibold" id="rec-string-control">8/10</p>
            </div>
            <div>
              <span class="text-sm text-gray-500">Confort</span>
              <p class="font-semibold" id="rec-string-comfort">5/10</p>
            </div>
            <div>
              <span class="text-sm text-gray-500">Prix</span>
              <p class="font-semibold text-green-600" id="rec-string-price">18â‚¬</p>
            </div>
          </div>
          <p class="text-gray-600 mt-4" id="rec-string-reason">Parfait pour gÃ©nÃ©rer du spin et du contrÃ´le.</p>
        </div>
      </div>

      <!-- Tension Recommendation -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
        <div class="flex items-center gap-2 mb-4">
          <span class="text-2xl">âš™ï¸</span>
          <h3 class="text-xl font-bold text-gray-900">Tension RecommandÃ©e</h3>
        </div>
        <div class="bg-blue-50 rounded-lg p-6">
          <div class="text-center">
            <span class="text-4xl font-bold text-blue-600" id="rec-tension">23-25 kg</span>
            <p class="text-gray-600 mt-2" id="rec-tension-reason">Tension moyenne pour un bon Ã©quilibre entre puissance et contrÃ´le.</p>
          </div>
        </div>
      </div>

      <!-- RCS Score -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center gap-2">
            <span class="text-2xl">ğŸ©º</span>
            <h3 class="text-xl font-bold text-gray-900">Score RCS - Confort Articulaire</h3>
          </div>
          <a href="/rcs-calculator.html" class="text-sm text-green-600 hover:underline">Calculateur dÃ©taillÃ© â†’</a>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Score Display -->
          <div class="text-center">
            <div id="rcs-score-display" class="inline-flex items-center justify-center w-28 h-28 rounded-full text-white text-4xl font-bold mb-3 shadow-lg" style="background: #FFD700;">
              50
            </div>
            <div id="rcs-decile-label" class="inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-bold" style="background: #FFD700; color: #000;">
              <span id="rcs-icon">âš–ï¸</span>
              <span id="rcs-label">D5 - Ã‰quilibrÃ© Souple</span>
            </div>
            <p id="rcs-description" class="text-gray-600 mt-2 text-sm">Club niveau moyen</p>
          </div>
          
          <!-- RCS Gauge -->
          <div class="flex flex-col justify-center">
            <div class="mb-3">
              <div class="h-4 rounded-full" style="background: linear-gradient(to right, #006400, #228B22, #32CD32, #9ACD32, #FFD700, #FFC000, #FF8C00, #FF6600, #FF4444, #CC0000);">
                <div id="rcs-indicator" class="w-5 h-5 bg-white border-4 border-gray-800 rounded-full shadow transform -translate-y-0.5" style="margin-left: 50%;"></div>
              </div>
              <div class="flex justify-between text-xs text-gray-500 mt-1">
                <span>Confort</span>
                <span>Performance</span>
              </div>
            </div>
            
            <div id="rcs-comment" class="p-3 rounded-lg text-sm" style="background: #FFD70020; border-left: 4px solid #FFD700;">
              <p class="text-gray-700"><strong>ğŸ’¬ Conseil :</strong> <span id="rcs-advice">Configuration Ã©quilibrÃ©e, adaptÃ©e Ã  la plupart des joueurs.</span></p>
            </div>
          </div>
        </div>
        
        <!-- Profile Evaluation -->
        <div id="rcs-profile-eval" class="hidden mt-4 p-4 rounded-lg border-2">
          <div class="flex items-center gap-2 font-semibold">
            <span id="rcs-eval-icon" class="text-xl">âœ…</span>
            <span id="rcs-eval-message">Configuration optimale pour votre profil</span>
          </div>
          <p id="rcs-eval-suggestion" class="mt-2 text-sm opacity-80"></p>
        </div>
      </div>

      <!-- Actions -->
      <div class="flex flex-col md:flex-row gap-4">
        <a href="/racquets.html" class="flex-1 px-6 py-4 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition text-center">
          Voir toutes les raquettes â†’
        </a>
        <a href="/strings.html" class="flex-1 px-6 py-4 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition text-center">
          Voir tous les cordages â†’
        </a>
        <button onclick="restartConfigurator()" class="flex-1 px-6 py-4 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition">
          ğŸ”„ Recommencer
        </button>
      </div>

      <!-- Share Results Section -->
      <div class="mt-8 bg-white rounded-xl border border-gray-200 p-6">
        <div class="flex items-center justify-between flex-wrap gap-4">
          <div class="flex items-center gap-3">
            <span class="text-2xl">ğŸ“¤</span>
            <div>
              <h4 class="font-semibold text-gray-900">Partagez votre setup</h4>
              <p class="text-sm text-gray-500">Montrez vos recommandations Ã  vos partenaires de tennis</p>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <button onclick="shareResult('copy')" class="flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition text-sm font-medium">
              ğŸ“‹ Copier
            </button>
            <button onclick="shareResult('whatsapp')" class="flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition text-sm font-medium">
              ğŸ’¬ WhatsApp
            </button>
            <button onclick="shareResult('twitter')" class="flex items-center gap-2 px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-800 transition text-sm font-medium">
              ğ• Twitter
            </button>
          </div>
        </div>
        <div id="shareConfirmation" class="hidden mt-3 p-3 bg-green-100 text-green-700 rounded-lg text-sm text-center">
          âœ… Lien copiÃ© dans le presse-papier !
        </div>
      </div>

      <!-- CTA Premium Section -->
      <div id="ctaPremiumSection" class="hidden mt-10 bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl border-2 border-amber-200 p-8">
        <div class="text-center mb-6">
          <span class="text-4xl mb-3 block">ğŸ¾</span>
          <h3 class="text-2xl font-bold text-gray-900 mb-2">Votre setup personnalisÃ© vous plaÃ®t ?</h3>
          <p class="text-gray-600">Passez Premium pour en profiter pleinement</p>
        </div>
        
        <div class="grid md:grid-cols-3 gap-4 mb-6">
          <div class="bg-white rounded-xl p-4 text-center shadow-sm">
            <span class="text-2xl mb-2 block">â™¾ï¸</span>
            <h4 class="font-semibold text-gray-900">Configurations illimitÃ©es</h4>
            <p class="text-sm text-gray-500 mt-1">Testez autant de profils que vous voulez</p>
          </div>
          <div class="bg-white rounded-xl p-4 text-center shadow-sm">
            <span class="text-2xl mb-2 block">ğŸ“”</span>
            <h4 class="font-semibold text-gray-900">Journal de cordage</h4>
            <p class="text-sm text-gray-500 mt-1">Suivez vos cordages et recevez des rappels</p>
          </div>
          <div class="bg-white rounded-xl p-4 text-center shadow-sm">
            <span class="text-2xl mb-2 block">ğŸ’¾</span>
            <h4 class="font-semibold text-gray-900">Sauvegarde setups</h4>
            <p class="text-sm text-gray-500 mt-1">Retrouvez vos configurations favorites</p>
          </div>
        </div>

        <div class="text-center">
          <div class="mb-4">
            <span class="text-3xl font-bold text-gray-900">19,99â‚¬</span>
            <span class="text-gray-600 ml-1">une seule fois</span>
            <p class="text-sm text-green-600 font-medium mt-1">ğŸ‰ AccÃ¨s Ã  vie - Pas d'abonnement !</p>
          </div>
          <a href="/premium.html" class="inline-block px-8 py-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold rounded-xl hover:from-amber-600 hover:to-orange-600 transition shadow-lg text-lg">
            âœ¨ DÃ©bloquer Premium
          </a>
          <p class="text-xs text-gray-500 mt-4">DÃ©jÃ  <span id="userCount">70</span>+ joueurs nous font confiance</p>
        </div>
      </div>
    </div>
  </main>

  <!-- Sticky Bottom Bar (visible only on results) -->
  <div id="stickyBottomBar" class="hidden fixed bottom-0 left-0 right-0 bg-white border-t-2 border-gray-200 shadow-lg z-50 transform translate-y-full transition-transform duration-300">
    <div class="max-w-4xl mx-auto px-4 py-3">
      <div class="flex items-center justify-between gap-4">
        <div class="hidden sm:flex items-center gap-3">
          <span class="text-2xl">ğŸ¾</span>
          <div>
            <p class="font-semibold text-gray-900 text-sm">Votre setup est prÃªt !</p>
            <p class="text-xs text-gray-500">Sauvegardez-le avec Premium</p>
          </div>
        </div>
        <div class="flex items-center gap-3 flex-1 sm:flex-none justify-end">
          <span class="text-lg font-bold text-gray-900">19,99â‚¬ <span class="text-sm font-normal text-gray-500">Ã  vie</span></span>
          <a href="/premium.html" class="px-6 py-2.5 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold rounded-lg hover:from-amber-600 hover:to-orange-600 transition shadow text-sm whitespace-nowrap">
            âœ¨ Premium
          </a>
          <button onclick="closeStickyBar()" class="p-2 text-gray-400 hover:text-gray-600 transition" aria-label="Fermer">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-gray-900 text-white mt-16">
    <div class="max-w-7xl mx-auto px-4 py-12">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div>
          <div class="flex items-center gap-2 mb-4">
            <span class="text-2xl">ğŸ¾</span>
            <span class="font-bold text-xl">Tennis String Advisor</span>
          </div>
          <p class="text-gray-400 text-sm">Expert en cordages et raquettes de tennis depuis 2024.</p>
        </div>
        <div>
          <h4 class="font-semibold mb-4">Navigation</h4>
          <ul class="space-y-2 text-gray-400 text-sm">
            <li><a href="/" class="hover:text-white transition">Accueil</a></li>
            <li><a href="/racquets.html" class="hover:text-white transition">Raquettes</a></li>
            <li><a href="/strings.html" class="hover:text-white transition">Cordages</a></li>
            <li><a href="/compare.html" class="hover:text-white transition">Comparateur</a></li>
          </ul>
        </div>
        <div>
          <h4 class="font-semibold mb-4">Outils</h4>
          <ul class="space-y-2 text-gray-400 text-sm">
            <li><a href="/configurator.html" class="hover:text-white transition">Configurateur</a></li>
            <li><a href="/guides.html" class="hover:text-white transition">Guides</a></li>
            <li><a href="/faq.html" class="hover:text-white transition">FAQ</a></li>
          </ul>
        </div>
        <div>
          <h4 class="font-semibold mb-4">Contact</h4>
          <p class="text-gray-400 text-sm">pleneuftrading@gmail.com</p>
        </div>
      </div>
      <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400 text-sm">
        <p>Â© 2025 Tennis String Advisor. Une marque de Pleneuf Trading LLC. Tous droits rÃ©servÃ©s.</p>
      </div>
    </div>
  </footer>

  <script>
    // Supabase config - wait for SDK to load (loaded with defer)
    const SUPABASE_URL = 'https://yhhdkllbaxuhwrfpsmev.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InloaGRrbGxiYXh1aHdyZnBzbWV2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU3NjI0MDEsImV4cCI6MjA4MTMzODQwMX0.2aC_gYZf0xxz6MXi5zcaCH2S64RBaQvXU7a5qiuD0_k';
    
    // Initialize supabase when SDK is ready - using supabaseClient to avoid conflict with SDK's window.supabase
    let supabaseClient = null;
    function initSupabase() {
      if (window.supabase && window.supabase.createClient) {
        supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        console.log('âœ… Supabase client initialized');
        // Now we can check auth state and load data
        checkUserStatus();
        loadCatalogData();
      } else {
        // Retry after 100ms if SDK not loaded yet
        setTimeout(initSupabase, 100);
      }
    }
    // Start initialization after DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initSupabase);
    } else {
      initSupabase();
    }

    // Configuration usage tracking
    let currentUser = null;
    let userProfile = null;
    let hasUsedFreeConfiguration = false;
    let isPremium = false;
    let configurationCount = 0;
    const FREE_CONFIGURATIONS = 2;
    const LOCAL_STORAGE_KEY = 'configurator_free_used';
    
    // Database cache
    // SOLUTION B: Use 'var' instead of 'let' to avoid Temporal Dead Zone
    // 'var' is hoisted and initialized to undefined, preventing TDZ errors
    var racquetsDB = [];
    var stringsDB = [];

    // SOLUTION 8: Read state from radio buttons instead of tracking in JS
    function getSelections() {
      return {
        level: document.querySelector('input[name="level"]:checked')?.value || null,
        frequency: document.querySelector('input[name="frequency"]:checked')?.value || null,
        style: document.querySelector('input[name="style"]:checked')?.value || null,
        physical: document.querySelector('input[name="physical"]:checked')?.value || null,
        'budget-racquet': document.querySelector('input[name="budget-racquet"]:checked')?.value || null,
        'budget-string': document.querySelector('input[name="budget-string"]:checked')?.value || null
      };
    }
    
    // Legacy selections object for compatibility (read from radio buttons)
    const selections = new Proxy({}, {
      get(target, prop) {
        const radioName = prop.toString();
        return document.querySelector(`input[name="${radioName}"]:checked`)?.value || null;
      }
    });

    // =====================================================
    // SOLUTION 8: NATIVE RADIO BUTTONS
    // =====================================================
    // No complex JavaScript needed! Radio buttons handle:
    // - Selection state (:checked pseudo-class)
    // - Mutual exclusivity (only one per name)
    // - Immune to external script interference
    // 
    // We just read values with querySelector when needed.

    // Navigate steps
    // Sticky bar state
    let stickyBarClosed = false;

    function goToStep(step) {
      // Track step navigation
      const stepNames = { 1: 'level', 2: 'style', 3: 'budget', 4: 'results' };
      if (typeof trackConfiguratorStep === 'function') {
        trackConfiguratorStep(step, stepNames[step] || 'unknown');
      }

      // Hide all steps
      document.querySelectorAll('[id^="step"]').forEach(el => {
        if (!el.id.includes('indicator')) el.classList.add('hidden');
      });
      // Show target step
      document.getElementById('step' + step).classList.remove('hidden');
      
      // Update indicators
      for (let i = 1; i <= 4; i++) {
        const indicator = document.getElementById('step' + i + '-indicator');
        indicator.classList.remove('step-active', 'step-completed', 'step-pending');
        if (i < step) {
          indicator.classList.add('step-completed');
          indicator.classList.add('text-white');
        } else if (i === step) {
          indicator.classList.add('step-active');
          indicator.classList.add('text-white');
        } else {
          indicator.classList.add('step-pending');
          indicator.classList.remove('text-white');
          indicator.classList.add('text-gray-500');
        }
      }
      
      // Update progress bars
      for (let i = 1; i <= 3; i++) {
        const progress = document.getElementById('progress' + i);
        if (i < step) {
          progress.classList.remove('bg-gray-200');
          progress.classList.add('bg-green-500');
        } else {
          progress.classList.add('bg-gray-200');
          progress.classList.remove('bg-green-500');
        }
      }

      // Handle sticky bar and CTA visibility on step 4 (results)
      const stickyBar = document.getElementById('stickyBottomBar');
      const ctaSection = document.getElementById('ctaPremiumSection');
      
      if (step === 4 && !isPremium) {
        // Show CTA section for non-premium users
        if (ctaSection) ctaSection.classList.remove('hidden');
        
        // Show sticky bar after a delay (if not manually closed)
        if (stickyBar && !stickyBarClosed) {
          stickyBar.classList.remove('hidden');
          setTimeout(() => {
            stickyBar.classList.remove('translate-y-full');
          }, 1500); // Show after 1.5 seconds
        }
      } else {
        // Hide for premium users or other steps
        if (ctaSection) ctaSection.classList.add('hidden');
        if (stickyBar) {
          stickyBar.classList.add('translate-y-full');
          setTimeout(() => stickyBar.classList.add('hidden'), 300);
        }
      }
    }

    // Close sticky bar
    function closeStickyBar() {
      stickyBarClosed = true;
      const stickyBar = document.getElementById('stickyBottomBar');
      if (stickyBar) {
        stickyBar.classList.add('translate-y-full');
        setTimeout(() => stickyBar.classList.add('hidden'), 300);
      }
    }
    window.closeStickyBar = closeStickyBar;

    // Check if user can configure
    function canConfigure() {
      if (isPremium) return true;
      
      if (currentUser) {
        return configurationCount < FREE_CONFIGURATIONS;
      } else {
        return !hasUsedFreeConfiguration;
      }
    }

    // Show paywall
    function showPaywall() {
      const paywall = document.getElementById('configuratorPaywall');
      paywall.classList.remove('hidden');
      paywall.classList.add('flex');
      document.body.style.overflow = 'hidden';
      // Track paywall shown event
      if (typeof trackPaywallShown === 'function') trackPaywallShown();
    }

    // Record configuration usage
    async function recordConfigurationUsage() {
      if (isPremium) return;
      
      if (currentUser) {
        configurationCount++;
        await supabaseClient
          .from('profiles')
          .update({ configurator_uses: configurationCount })
          .eq('id', currentUser.id);
        
        hasUsedFreeConfiguration = configurationCount >= FREE_CONFIGURATIONS;
      } else {
        localStorage.setItem(LOCAL_STORAGE_KEY, 'true');
        hasUsedFreeConfiguration = true;
      }
      
      updateUsageBanners();
    }

    // Update banners
    function updateUsageBanners() {
      const freeTrialBanner = document.getElementById('freeTrialBanner');
      const premiumBanner = document.getElementById('premiumBanner');
      const remainingEl = document.getElementById('remainingConfigurations');
      
      if (isPremium) {
        freeTrialBanner.classList.add('hidden');
        premiumBanner.classList.remove('hidden');
      } else {
        premiumBanner.classList.add('hidden');
        const remaining = Math.max(0, FREE_CONFIGURATIONS - (currentUser ? configurationCount : (hasUsedFreeConfiguration ? 1 : 0)));
        remainingEl.textContent = remaining;
        
        if (remaining === 0) {
          freeTrialBanner.innerHTML = `
            <span class="font-medium">ğŸ”’ Essai gratuit terminÃ©</span>
            <span class="mx-2">|</span>
            <a href="/premium.html" class="underline font-semibold hover:text-green-100">Passer Premium pour continuer â†’</a>
          `;
          freeTrialBanner.classList.remove('from-green-500', 'to-green-600');
          freeTrialBanner.classList.add('from-amber-500', 'to-orange-500');
        }
        freeTrialBanner.classList.remove('hidden');
      }
    }

    // Check user status
    async function checkUserStatus() {
      if (!supabaseClient) {
        console.log('â³ Supabase not ready, using local storage');
        hasUsedFreeConfiguration = localStorage.getItem(LOCAL_STORAGE_KEY) === 'true';
        updateUsageBanners();
        return;
      }
      try {
        const { data: { session } } = await supabaseClient.auth.getSession();
        
        if (session) {
          currentUser = session.user;
          
          const { data: profile } = await supabaseClient
            .from('profiles')
            .select('is_premium, configurator_uses')
            .eq('id', currentUser.id)
            .single();
          
          if (profile) {
            userProfile = profile;
            isPremium = profile.is_premium === true;
            configurationCount = profile.configurator_uses || 0;
            hasUsedFreeConfiguration = configurationCount >= FREE_CONFIGURATIONS;
          }
          
          document.getElementById('paywallAuthLink').textContent = 'Retour Ã  mon compte';
          document.getElementById('paywallAuthLink').href = '/account.html';
        } else {
          hasUsedFreeConfiguration = localStorage.getItem(LOCAL_STORAGE_KEY) === 'true';
        }
        
        updateUsageBanners();
      } catch (error) {
        console.error('Error checking user status:', error);
      }
    }

    // Load racquets and strings from database
    async function loadCatalogData() {
      if (!supabaseClient) {
        console.log('â³ Supabase not ready, skipping catalog load');
        return;
      }
      try {
        // Load racquets
        const { data: racquets, error: rError } = await supabaseClient
          .from('racquets')
          .select('*')
          .order('brand', { ascending: true });
        
        if (racquets) {
          racquetsDB = racquets;
          console.log(`Loaded ${racquetsDB.length} racquets from database`);
        }
        
        // Load strings
        const { data: strings, error: sError } = await supabaseClient
          .from('strings')
          .select('*')
          .order('brand', { ascending: true });
        
        if (strings) {
          stringsDB = strings;
          console.log(`Loaded ${stringsDB.length} strings from database`);
        }
      } catch (error) {
        console.error('Error loading catalog:', error);
      }
    }

    // Initialize on load - called by initSupabase() when SDK is ready
    // checkUserStatus() and loadCatalogData() are now called in initSupabase()

    // Smart racquet picker based on criteria
    function pickBestRacquet(criteria) {
      console.log('ğŸ¾ pickBestRacquet called with criteria:', criteria);
      
      // Check if racquetsDB is initialized
      if (typeof racquetsDB === 'undefined' || !racquetsDB || racquetsDB.length === 0) {
        console.log('âŒ racquetsDB not loaded, returning null');
        return null;
      }
      
      console.log(`ğŸ“Š Starting with ${racquetsDB.length} racquets`);
      let candidates = [...racquetsDB];
      
      // Filter by player level
      if (criteria.level) {
        const beforeCount = candidates.length;
        candidates = candidates.filter(r => {
          const levels = r.player_level || [];
          return levels.some(l => l.toLowerCase() === criteria.level.toLowerCase());
        });
        console.log(`  Level filter (${criteria.level}): ${beforeCount} â†’ ${candidates.length}`);
      }
      
      // Filter by category
      if (criteria.category) {
        const beforeCount = candidates.length;
        candidates = candidates.filter(r => {
          const cat = (r.category || '').toLowerCase();
          return criteria.category.some(c => cat.includes(c.toLowerCase()));
        });
        console.log(`  Category filter (${criteria.category}): ${beforeCount} â†’ ${candidates.length}`);
      }
      
      // Filter by stiffness range (comfort requirement)
      // Apply stiffness filter only to racquets with known stiffness values
      if (criteria.maxStiffness) {
        const beforeCount = candidates.length;
        const stiffnessFiltered = candidates.filter(r => r.stiffness && r.stiffness <= criteria.maxStiffness);
        // If stiffness filter eliminates all candidates, relax it to include unknown stiffness
        if (stiffnessFiltered.length > 0) {
          candidates = stiffnessFiltered;
        } else {
          console.log(`  âš ï¸ Max stiffness filter too restrictive, including unknown stiffness racquets`);
          candidates = candidates.filter(r => !r.stiffness || r.stiffness <= criteria.maxStiffness);
        }
        console.log(`  Max stiffness filter (${criteria.maxStiffness}): ${beforeCount} â†’ ${candidates.length}`);
      }
      
      if (criteria.minStiffness) {
        const beforeCount = candidates.length;
        const stiffnessFiltered = candidates.filter(r => r.stiffness && r.stiffness >= criteria.minStiffness);
        // If stiffness filter eliminates all candidates, relax it to include unknown stiffness
        if (stiffnessFiltered.length > 0) {
          candidates = stiffnessFiltered;
        } else {
          console.log(`  âš ï¸ Min stiffness filter too restrictive, including unknown stiffness racquets`);
          candidates = candidates.filter(r => !r.stiffness || r.stiffness >= criteria.minStiffness);
        }
        console.log(`  Min stiffness filter (${criteria.minStiffness}): ${beforeCount} â†’ ${candidates.length}`);
      }
      
      // Sort by preference
      if (criteria.preferLightweight) {
        candidates.sort((a, b) => (a.weight || 300) - (b.weight || 300));
      }
      
      if (criteria.preferComfort) {
        candidates.sort((a, b) => (a.stiffness || 70) - (b.stiffness || 70));
      }
      
      // Pick one randomly from top 3 to add variety
      const topCandidates = candidates.slice(0, Math.min(3, candidates.length));
      const picked = topCandidates[Math.floor(Math.random() * topCandidates.length)] || candidates[0];
      console.log(`âœ… Picked racquet: ${picked ? picked.brand + ' ' + picked.model : 'null'}`);
      return picked;
    }

    // Smart string picker
    function pickBestString(criteria) {
      console.log('ğŸ¸ pickBestString called with criteria:', criteria);
      
      // Check if stringsDB is initialized
      if (typeof stringsDB === 'undefined' || !stringsDB || stringsDB.length === 0) {
        console.log('âŒ stringsDB not loaded, returning null');
        return null;
      }
      
      console.log(`ğŸ“Š Starting with ${stringsDB.length} strings`);
      let candidates = [...stringsDB];
      
      // Filter by type
      if (criteria.types) {
        const beforeCount = candidates.length;
        candidates = candidates.filter(s => {
          const type = (s.type || '').toLowerCase();
          return criteria.types.some(t => type.includes(t.toLowerCase()));
        });
        console.log(`  Type filter (${criteria.types.join(', ')}): ${beforeCount} â†’ ${candidates.length}`);
      }
      
      // Sort by comfort if needed
      if (criteria.preferComfort) {
        candidates.sort((a, b) => (b.comfort || 5) - (a.comfort || 5));
      }
      
      // Sort by spin if needed
      if (criteria.preferSpin) {
        candidates.sort((a, b) => (b.spin || 5) - (a.spin || 5));
      }
      
      // Sort by control if needed
      if (criteria.preferControl) {
        candidates.sort((a, b) => (b.control || 5) - (a.control || 5));
      }
      
      const topCandidates = candidates.slice(0, Math.min(3, candidates.length));
      const picked = topCandidates[Math.floor(Math.random() * topCandidates.length)] || candidates[0];
      console.log(`âœ… Picked string: ${picked ? picked.brand + ' ' + picked.model : 'null'}`);
      return picked;
    }

    // Generate result
    function generateResult() {
      console.log('ğŸ‰ generateResult called!');
      
      // Get current selections
      const currentSelections = getSelections();
      console.log('ğŸ“Š Selections:', currentSelections);
      
      // TEMPORARY: Bypass paywall check for debugging
      // Check if user can configure
      let canUse = true;
      try {
        canUse = canConfigure();
        console.log('âœ… canConfigure:', canUse);
      } catch (error) {
        console.error('âŒ Error in canConfigure:', error);
        canUse = true; // Allow anyway for debugging
      }
      
      if (!canUse) {
        console.log('ğŸ”’ Showing paywall...');
        showPaywall();
        return;
      }
      
      console.log('âœ… Generating recommendations...');
      
      // Defaults (fallback if DB not loaded)
      let racquet = { brand: 'Babolat', name: 'Pure Drive', category: 'Polyvalent', weight: '300g', head: '100 sq in', stiffness: 72, stiffnessDisplay: 'RA 72', price: '269â‚¬', reason: 'Raquette polyvalente idÃ©ale pour progresser.', stringStiffness: 240 };
      let string = { brand: 'Babolat', name: 'RPM Blast', type: 'Polyester', spin: '10/10', control: '8/10', comfort: '5/10', price: '18â‚¬', reason: 'Excellent pour gÃ©nÃ©rer du spin.', stiffness: 240 };
      let tension = { value: '23-25 kg', numValue: 24, reason: 'Tension moyenne pour Ã©quilibre puissance/contrÃ´le.' };
      let rcsProfile = null;
      
      let racquetCriteria = {};
      let stringCriteria = {};

      // PRIORITY 1: Adjust for LEVEL (dÃ©butant needs confort!)
      if (currentSelections.level === 'debutant') {
        racquetCriteria = {
          level: 'Beginner',
          category: ['Light', 'Tweener'],
          maxStiffness: 66,
          preferComfort: true,
          preferLightweight: true
        };
        stringCriteria = {
          types: ['Multifilament', 'Natural Gut'],
          preferComfort: true
        };
        tension = { value: '20-22 kg', numValue: 21, reason: 'Tension basse pour maximiser le confort et la puissance.' };
        rcsProfile = 'debutant';
        
        const dbRacquet = pickBestRacquet(racquetCriteria);
        const dbString = pickBestString(stringCriteria);
        
        if (dbRacquet) {
          racquet = {
            brand: dbRacquet.brand,
            name: dbRacquet.model,
            category: dbRacquet.category || 'Confort',
            weight: `${dbRacquet.weight}g`,
            head: `${dbRacquet.head_size} sq in`,
            stiffness: dbRacquet.stiffness || 55,
            stiffnessDisplay: `RA ${dbRacquet.stiffness || 55}`,
            price: `${dbRacquet.price_eur}â‚¬`,
            reason: 'Raquette flexible et confortable, idÃ©ale pour dÃ©buter sans forcer.'
          };
        } else {
          // Fallback
          racquet = { brand: 'Wilson', name: 'Clash 100', category: 'Confort', weight: '295g', head: '100 sq in', stiffness: 55, stiffnessDisplay: 'RA 55', price: '249â‚¬', reason: 'Raquette trÃ¨s flexible et confortable, idÃ©ale pour dÃ©buter sans forcer.' };
        }
        
        if (dbString) {
          string = {
            brand: dbString.brand,
            name: dbString.model,
            type: dbString.type,
            spin: `${dbString.spin || 6}/10`,
            control: `${dbString.control || 7}/10`,
            comfort: `${dbString.comfort || 9}/10`,
            price: `${dbString.price_eur}â‚¬`,
            reason: 'Cordage doux qui protÃ¨ge le bras et offre de la puissance.',
            stiffness: dbString.stiffness || 150
          };
        } else {
          string = { brand: 'Tecnifibre', name: 'NRG2', type: 'Multifilament', spin: '6/10', control: '7/10', comfort: '10/10', price: '16â‚¬', reason: 'Multifilament doux qui protÃ¨ge le bras et offre de la puissance.', stiffness: 145 };
        }
      } else if (currentSelections.level === 'intermediaire') {
        racquetCriteria = {
          level: 'Intermediate',
          category: ['Tweener', 'Modern Player'],
          maxStiffness: 67,
          minStiffness: 60
        };
        stringCriteria = {
          types: ['Multifilament', 'Hybrid'],
          preferComfort: true
        };
        tension = { value: '22-24 kg', numValue: 23, reason: 'Tension modÃ©rÃ©e pour confort et contrÃ´le.' };
        rcsProfile = 'club';
        
        const dbRacquet = pickBestRacquet(racquetCriteria);
        const dbString = pickBestString(stringCriteria);
        
        if (dbRacquet) {
          racquet = {
            brand: dbRacquet.brand,
            name: dbRacquet.model,
            category: dbRacquet.category || 'Polyvalent',
            weight: `${dbRacquet.weight}g`,
            head: `${dbRacquet.head_size} sq in`,
            stiffness: dbRacquet.stiffness || 62,
            stiffnessDisplay: `RA ${dbRacquet.stiffness || 62}`,
            price: `${dbRacquet.price_eur}â‚¬`,
            reason: 'Raquette Ã©quilibrÃ©e pour joueur en progression.'
          };
        } else {
          racquet = { brand: 'Head', name: 'Speed MP', category: 'Polyvalent', weight: '300g', head: '100 sq in', stiffness: 62, stiffnessDisplay: 'RA 62', price: '259â‚¬', reason: 'Raquette Ã©quilibrÃ©e pour joueur en progression.' };
        }
        
        if (dbString) {
          string = {
            brand: dbString.brand,
            name: dbString.model,
            type: dbString.type,
            spin: `${dbString.spin || 7}/10`,
            control: `${dbString.control || 7}/10`,
            comfort: `${dbString.comfort || 8}/10`,
            price: `${dbString.price_eur}â‚¬`,
            reason: 'Cordage confortable avec bon retour d\'Ã©nergie.',
            stiffness: dbString.stiffness || 160
          };
        } else {
          string = { brand: 'Wilson', name: 'NXT', type: 'Multifilament', spin: '6/10', control: '7/10', comfort: '9/10', price: '22â‚¬', reason: 'Multifilament confortable avec bon retour d\'Ã©nergie.', stiffness: 155 };
        }
      }

      // PRIORITY 2: Adjust for physical issues (OVERRIDES level for safety)
      if (currentSelections.physical === 'bras' || currentSelections.physical === 'epaule') {
        racquetCriteria = {
          level: currentSelections.level === 'debutant' ? 'Beginner' : 'Intermediate',
          category: ['Tweener', 'Light', 'Comfort'],
          maxStiffness: 66, // Increased from 64 to include comfort racquets (65-66 RA)
          preferComfort: true
        };
        stringCriteria = {
          types: ['Multifilament', 'Natural Gut'],
          preferComfort: true
        };
        tension = { value: '21-23 kg', numValue: 22, reason: 'Tension basse pour plus de confort et moins de vibrations.' };
        rcsProfile = 'tennis_elbow';
        
        const dbRacquet = pickBestRacquet(racquetCriteria);
        const dbString = pickBestString(stringCriteria);
        
        if (dbRacquet) {
          racquet = {
            brand: dbRacquet.brand,
            name: dbRacquet.model,
            category: dbRacquet.category || 'Confort',
            weight: `${dbRacquet.weight}g`,
            head: `${dbRacquet.head_size} sq in`,
            stiffness: dbRacquet.stiffness || 62,
            stiffnessDisplay: `RA ${dbRacquet.stiffness || 62}`,
            price: `${dbRacquet.price_eur}â‚¬`,
            reason: 'Raquette confortable qui absorbe bien les vibrations.'
          };
        } else {
          racquet = { brand: 'Yonex', name: 'EZONE 100', category: 'Confort', weight: '300g', head: '100 sq in', stiffness: 62, stiffnessDisplay: 'RA 62', price: '249â‚¬', reason: 'Raquette trÃ¨s confortable, absorbe bien les vibrations.' };
        }
        
        if (dbString) {
          string = {
            brand: dbString.brand,
            name: dbString.model,
            type: dbString.type,
            spin: `${dbString.spin || 6}/10`,
            control: `${dbString.control || 7}/10`,
            comfort: `${dbString.comfort || 10}/10`,
            price: `${dbString.price_eur}â‚¬`,
            reason: 'Cordage ultra-confortable, excellent pour protÃ©ger le bras.',
            stiffness: dbString.stiffness || 155
          };
        } else {
          string = { brand: 'Wilson', name: 'NXT', type: 'Multifilament', spin: '6/10', control: '7/10', comfort: '10/10', price: '22â‚¬', reason: 'Multifilament ultra-confortable, excellent pour protÃ©ger le bras.', stiffness: 155 };
        }
      }
      // PRIORITY 3: Customize based on style (ONLY for advanced/competition players)
      else if (currentSelections.level === 'avance' || currentSelections.level === 'competition') {
        if (currentSelections.style === 'puissance') {
          racquetCriteria = {
            level: currentSelections.level === 'avance' ? 'Advanced' : 'Pro',
            category: ['Power', 'Modern Player'],
            minStiffness: 66
          };
          stringCriteria = {
            types: ['Polyester', 'Co-Polyester'],
            preferControl: true
          };
          tension = { value: '24-26 kg', numValue: 25, reason: 'Tension plus haute pour plus de contrÃ´le.' };
          rcsProfile = 'competiteur';
          
          const dbRacquet = pickBestRacquet(racquetCriteria);
          const dbString = pickBestString(stringCriteria);
          
          if (dbRacquet) {
            racquet = {
              brand: dbRacquet.brand,
              name: dbRacquet.model,
              category: dbRacquet.category || 'Puissance',
              weight: `${dbRacquet.weight}g`,
              head: `${dbRacquet.head_size} sq in`,
              stiffness: dbRacquet.stiffness || 70,
              stiffnessDisplay: `RA ${dbRacquet.stiffness || 70}`,
              price: `${dbRacquet.price_eur}â‚¬`,
              reason: 'Raquette puissante avec excellent retour d\'Ã©nergie.'
            };
          } else {
            racquet = { brand: 'Babolat', name: 'Pure Drive', category: 'Puissance', weight: '300g', head: '100 sq in', stiffness: 72, stiffnessDisplay: 'RA 72', price: '269â‚¬', reason: 'Raquette puissante avec excellent retour d\'Ã©nergie.' };
          }
          
          if (dbString) {
            string = {
              brand: dbString.brand,
              name: dbString.model,
              type: dbString.type,
              spin: `${dbString.spin || 8}/10`,
              control: `${dbString.control || 9}/10`,
              comfort: `${dbString.comfort || 6}/10`,
              price: `${dbString.price_eur}â‚¬`,
              reason: 'ContrÃ´le optimal pour canaliser votre puissance.',
              stiffness: dbString.stiffness || 230
            };
          } else {
            string = { brand: 'Luxilon', name: 'ALU Power', type: 'Polyester', spin: '8/10', control: '9/10', comfort: '6/10', price: '19â‚¬', reason: 'ContrÃ´le optimal pour canaliser votre puissance.', stiffness: 230 };
          }
        } else if (currentSelections.style === 'controle') {
          racquetCriteria = {
            level: currentSelections.level === 'avance' ? 'Advanced' : 'Pro',
            category: ['Control', 'Classic Player']
          };
          stringCriteria = {
            types: ['Polyester'],
            preferControl: true
          };
          tension = { value: '25-27 kg', numValue: 26, reason: 'Tension haute pour maximiser le contrÃ´le.' };
          rcsProfile = 'confirme';
          
          const dbRacquet = pickBestRacquet(racquetCriteria);
          const dbString = pickBestString(stringCriteria);
          
          if (dbRacquet) {
            racquet = {
              brand: dbRacquet.brand,
              name: dbRacquet.model,
              category: dbRacquet.category || 'ContrÃ´le',
              weight: `${dbRacquet.weight}g`,
              head: `${dbRacquet.head_size} sq in`,
              stiffness: dbRacquet.stiffness || 63,
              stiffnessDisplay: `RA ${dbRacquet.stiffness || 63}`,
              price: `${dbRacquet.price_eur}â‚¬`,
              reason: 'Raquette de contrÃ´le pour prÃ©cision maximale.'
            };
          } else {
            racquet = { brand: 'Wilson', name: 'Pro Staff 97', category: 'ContrÃ´le', weight: '315g', head: '97 sq in', stiffness: 63, stiffnessDisplay: 'RA 63', price: '299â‚¬', reason: 'Raquette de contrÃ´le ultime, utilisÃ©e par Federer.' };
          }
          
          if (dbString) {
            string = {
              brand: dbString.brand,
              name: dbString.model,
              type: dbString.type,
              spin: `${dbString.spin || 7}/10`,
              control: `${dbString.control || 9}/10`,
              comfort: `${dbString.comfort || 5}/10`,
              price: `${dbString.price_eur}â‚¬`,
              reason: 'PrÃ©cision et durabilitÃ© excellentes.',
              stiffness: dbString.stiffness || 220
            };
          } else {
            string = { brand: 'Head', name: 'Hawk', type: 'Polyester', spin: '7/10', control: '9/10', comfort: '5/10', price: '12â‚¬', reason: 'PrÃ©cision et durabilitÃ© excellentes.', stiffness: 215 };
          }
        } else if (currentSelections.style === 'spin') {
          racquetCriteria = {
            level: currentSelections.level === 'avance' ? 'Advanced' : 'Pro',
            category: ['Modern Player', 'Spin']
          };
          stringCriteria = {
            types: ['Polyester', 'Co-Polyester'],
            preferSpin: true
          };
          tension = { value: '23-25 kg', numValue: 24, reason: 'Tension moyenne pour maximiser l\'accroche.' };
          rcsProfile = 'club';
          
          const dbRacquet = pickBestRacquet(racquetCriteria);
          const dbString = pickBestString(stringCriteria);
          
          if (dbRacquet) {
            racquet = {
              brand: dbRacquet.brand,
              name: dbRacquet.model,
              category: dbRacquet.category || 'Spin',
              weight: `${dbRacquet.weight}g`,
              head: `${dbRacquet.head_size} sq in`,
              stiffness: dbRacquet.stiffness || 67,
              stiffnessDisplay: `RA ${dbRacquet.stiffness || 67}`,
              price: `${dbRacquet.price_eur}â‚¬`,
              reason: 'Raquette optimisÃ©e pour gÃ©nÃ©rer un maximum de spin.'
            };
          } else {
            racquet = { brand: 'Babolat', name: 'Pure Aero', category: 'Spin', weight: '300g', head: '100 sq in', stiffness: 67, stiffnessDisplay: 'RA 67', price: '279â‚¬', reason: 'La raquette de Nadal et Alcaraz, roi du spin.' };
          }
          
          if (dbString) {
            string = {
              brand: dbString.brand,
              name: dbString.model,
              type: dbString.type,
              spin: `${dbString.spin || 10}/10`,
              control: `${dbString.control || 8}/10`,
              comfort: `${dbString.comfort || 5}/10`,
              price: `${dbString.price_eur}â‚¬`,
              reason: 'Cordage pour un spin maximum.',
              stiffness: dbString.stiffness || 240
            };
          } else {
            string = { brand: 'Babolat', name: 'RPM Blast', type: 'Polyester', spin: '10/10', control: '8/10', comfort: '5/10', price: '18â‚¬', reason: 'Le cordage de Nadal pour un spin maximum.', stiffness: 240 };
          }
        }
      }

      // Update UI - Racquet
      document.getElementById('rec-racquet-brand').textContent = racquet.brand;
      document.getElementById('rec-racquet-name').textContent = racquet.name;
      document.getElementById('rec-racquet-category').textContent = racquet.category;
      document.getElementById('rec-racquet-weight').textContent = racquet.weight;
      document.getElementById('rec-racquet-head').textContent = racquet.head;
      document.getElementById('rec-racquet-stiffness').textContent = racquet.stiffnessDisplay;
      document.getElementById('rec-racquet-price').textContent = racquet.price;
      document.getElementById('rec-racquet-reason').textContent = racquet.reason;

      // Update UI - String
      document.getElementById('rec-string-brand').textContent = string.brand;
      document.getElementById('rec-string-name').textContent = string.name;
      document.getElementById('rec-string-type').textContent = string.type;
      document.getElementById('rec-string-spin').textContent = string.spin;
      document.getElementById('rec-string-control').textContent = string.control;
      document.getElementById('rec-string-comfort').textContent = string.comfort;
      document.getElementById('rec-string-price').textContent = string.price;
      document.getElementById('rec-string-reason').textContent = string.reason;

      // Update UI - Tension
      document.getElementById('rec-tension').textContent = tension.value;
      document.getElementById('rec-tension-reason').textContent = tension.reason;

      // Calculate and display RCS
      updateRCSDisplay(racquet.stiffness, string.stiffness, tension.numValue, rcsProfile);

      // Record usage
      recordConfigurationUsage();

      // Track configurator completion
      if (typeof trackConfiguratorComplete === 'function') {
        trackConfiguratorComplete(
          racquet.brand + ' ' + racquet.name,
          string.brand + ' ' + string.name,
          tension.value
        );
      }

      goToStep(4);
    }

    // Update RCS Display
    function updateRCSDisplay(ra, stringStiffness, tensionKg, profile) {
      if (typeof RCS === 'undefined') {
        console.error('RCS calculator not loaded');
        return;
      }

      const result = RCS.calculate(ra, stringStiffness, tensionKg);
      const { rcs, decile, quintile } = result;

      // Update score display
      document.getElementById('rcs-score-display').textContent = rcs;
      document.getElementById('rcs-score-display').style.background = decile.color;
      document.getElementById('rcs-score-display').style.color = decile.textColor;

      // Update decile label
      document.getElementById('rcs-icon').textContent = decile.icon;
      document.getElementById('rcs-label').textContent = `D${decile.number} - ${decile.label}`;
      document.getElementById('rcs-decile-label').style.background = decile.color;
      document.getElementById('rcs-decile-label').style.color = decile.textColor;

      // Update description
      document.getElementById('rcs-description').textContent = decile.description;

      // Update gauge indicator
      document.getElementById('rcs-indicator').style.marginLeft = `calc(${rcs}% - 10px)`;

      // Update comment box
      const commentBox = document.getElementById('rcs-comment');
      commentBox.style.background = decile.color + '20';
      commentBox.style.borderLeftColor = decile.color;
      
      // Generate advice based on RCS
      let advice = '';
      if (rcs < 30) {
        advice = 'Configuration trÃ¨s confortable. Excellente pour prÃ©server vos articulations.';
      } else if (rcs < 50) {
        advice = 'Configuration Ã©quilibrÃ©e, adaptÃ©e Ã  la plupart des joueurs de club.';
      } else if (rcs < 70) {
        advice = 'Configuration dynamique. Assurez-vous d\'avoir une bonne condition physique.';
      } else {
        advice = 'âš ï¸ Configuration exigeante. Ã‰chauffement rigoureux recommandÃ©.';
      }
      document.getElementById('rcs-advice').textContent = advice;

      // Profile evaluation if applicable
      if (profile) {
        const evaluation = RCS.evaluateForProfile(rcs, profile);
        const evalContainer = document.getElementById('rcs-profile-eval');
        evalContainer.classList.remove('hidden');
        
        const statusColors = {
          'optimal': { bg: 'bg-green-50', border: 'border-green-300', text: 'text-green-800' },
          'trop_souple': { bg: 'bg-blue-50', border: 'border-blue-300', text: 'text-blue-800' },
          'trop_rigide': { bg: 'bg-red-50', border: 'border-red-300', text: 'text-red-800' }
        };
        const colors = statusColors[evaluation.status] || statusColors['optimal'];
        
        evalContainer.className = `mt-4 p-4 rounded-lg border-2 ${colors.bg} ${colors.border}`;
        document.getElementById('rcs-eval-icon').textContent = evaluation.icon;
        document.getElementById('rcs-eval-message').textContent = evaluation.message;
        document.getElementById('rcs-eval-message').className = `font-semibold ${colors.text}`;
        document.getElementById('rcs-eval-suggestion').textContent = evaluation.suggestion || '';
        document.getElementById('rcs-eval-suggestion').className = `mt-2 text-sm ${colors.text} opacity-80`;
      } else {
        document.getElementById('rcs-profile-eval').classList.add('hidden');
      }
    }

    // Check auth state for nav - reuses global supabase instance
    async function checkAuthForNav() {
      try {
        // Use the global supabase instance (already declared at line 686)
        if (typeof supabaseClient === 'undefined') {
          console.log('Supabase not ready yet, skipping auth check');
          return;
        }
        
        const { data: { session } } = await supabaseClient.auth.getSession();
        const authLink = document.getElementById('authLink');
        if (session) {
          authLink.href = '/account.html';
          authLink.innerHTML = 'ğŸ‘¤ Mon Compte';
        } else {
          authLink.href = '/auth.html';
          authLink.innerHTML = 'ğŸ‘¤ Connexion';
        }
      } catch (e) { console.log('Auth check skipped:', e.message); }
    }
    // Delay auth check to ensure Supabase SDK is loaded (defer script)
    setTimeout(checkAuthForNav, 100);

    // Restart
    function restartConfigurator() {
      // Uncheck all radio buttons
      document.querySelectorAll('input[type="radio"].option-input').forEach(radio => {
        radio.checked = false;
      });
      goToStep(1);
    }

    // SOLUTION 10: Ultra-simple form handler
    function handleGenerate() {
      console.log('ğŸš€ handleGenerate() called from form onsubmit');
      try {
        generateResult();
      } catch (error) {
        console.error('âŒ Error in generateResult:', error);
        alert('Erreur: ' + error.message);
      }
      return false; // Prevent form submission
    }
    
    // Share result function
    function shareResult(method) {
      const racquet = document.getElementById('rec-racquet-brand').textContent + ' ' + document.getElementById('rec-racquet-name').textContent;
      const string = document.getElementById('rec-string-brand').textContent + ' ' + document.getElementById('rec-string-name').textContent;
      const tension = document.getElementById('rec-tension').textContent;
      
      const text = `ğŸ¾ Mon setup Tennis String Advisor:\n\nğŸ¾ Raquette: ${racquet}\nğŸ§µ Cordage: ${string}\nâš™ï¸ Tension: ${tension}\n\nTrouve ton setup idÃ©al sur:`;
      const url = 'https://tennisstringadvisor.org/configurator.html';
      
      if (method === 'copy') {
        navigator.clipboard.writeText(text + '\n' + url).then(() => {
          const confirmation = document.getElementById('shareConfirmation');
          confirmation.classList.remove('hidden');
          setTimeout(() => confirmation.classList.add('hidden'), 3000);
        });
        if (typeof trackShare === 'function') trackShare('copy_link', 'configurator_result');
      } else if (method === 'whatsapp') {
        window.open(`https://wa.me/?text=${encodeURIComponent(text + '\n' + url)}`, '_blank');
        if (typeof trackShare === 'function') trackShare('whatsapp', 'configurator_result');
      } else if (method === 'twitter') {
        window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`, '_blank');
        if (typeof trackShare === 'function') trackShare('twitter', 'configurator_result');
      }
    }
    window.shareResult = shareResult;

    // Make functions globally accessible
    window.goToStep = goToStep;
    window.restartConfigurator = restartConfigurator;
    window.generateResult = generateResult;
    window.getSelections = getSelections;
    window.handleGenerate = handleGenerate;
    
    // =====================================================
    // SOLUTION 8: SIMPLE EVENT HANDLING FOR NAV BUTTONS
    // =====================================================
    // Radio buttons handle themselves - we only need nav
    
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ğŸš€ Configurator v8 (Native Radio Buttons) initializing...');
      
      // Initialize step 1
      goToStep(1);
      
      // SOLUTION 10: Use FORM submit instead of button click
      // Forms are harder for external scripts to intercept
      const generateForm = document.getElementById('generateForm');
      if (generateForm) {
        generateForm.addEventListener('submit', function(e) {
          console.log('ğŸ‰ Generate FORM submitted (capture phase)');
          e.stopPropagation();
          e.stopImmediatePropagation();
          e.preventDefault();
          generateResult();
          return false;
        }, { capture: true }); // Execute in capture phase
        console.log('âœ… Generate FORM listener attached with capture:true');
      }
      
      // Fallback: Also listen on button directly
      const generateBtn = document.getElementById('generateBtn');
      if (generateBtn) {
        generateBtn.addEventListener('click', function(e) {
          console.log('ğŸ‰ Generate button clicked (capture phase - fallback)');
          e.stopPropagation();
          e.stopImmediatePropagation();
          e.preventDefault();
          generateResult();
          return false;
        }, { capture: true });
        console.log('âœ… Generate button listener attached (fallback)');
      }
      
      console.log('âœ… Configurator v8 ready!');
      console.log('ğŸ“‹ Total radio inputs:', document.querySelectorAll('input[type="radio"]').length);
      console.log('ğŸ”˜ Navigation uses onclick attributes (immune to external scripts)');
    });
  </script>
</body>
</html>
