<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Bouton G√©n√©rer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Load external scripts like real configurator -->
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    #log {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #000;
      color: #0f0;
      padding: 10px;
      font-family: monospace;
      font-size: 11px;
      max-height: 250px;
      overflow-y: auto;
      z-index: 9999;
    }
    .log-entry { margin: 3px 0; border-bottom: 1px solid #333; }
    .log-error { color: #f00; }
    .log-success { color: #0f0; }
    .log-info { color: #ff0; }
  </style>
</head>
<body class="bg-gray-50 p-4">
  <h1 class="text-2xl font-bold mb-4">üî¨ Test Bouton G√©n√©rer</h1>
  
  <div class="bg-white p-6 rounded-xl mb-4">
    <h2 class="font-bold mb-4">S√©lections</h2>
    <div class="space-y-3">
      <div>
        <input type="radio" name="level" id="l1" value="debutant" class="hidden">
        <label for="l1" class="block p-4 border-2 rounded cursor-pointer">
          <input type="radio" name="level" value="debutant"> D√©butant
        </label>
      </div>
      <div>
        <input type="radio" name="frequency" id="f1" value="regulier" class="hidden">
        <label for="f1" class="block p-4 border-2 rounded cursor-pointer">
          <input type="radio" name="frequency" value="regulier"> R√©gulier
        </label>
      </div>
    </div>
  </div>

  <div class="space-y-3">
    <button onclick="testGenerateResult(); return false;" class="w-full px-6 py-4 bg-green-600 text-white rounded-lg font-semibold text-lg">
      üéâ Voir mes recommandations (onclick)
    </button>
    
    <button id="testBtn2" class="w-full px-6 py-4 bg-blue-600 text-white rounded-lg font-semibold text-lg">
      üß™ Test avec addEventListener
    </button>
  </div>

  <div id="log"></div>

  <script>
    // Logging
    const logEl = document.getElementById('log');
    function log(msg, type = 'info') {
      const time = new Date().toLocaleTimeString();
      const entry = document.createElement('div');
      entry.className = `log-entry log-${type}`;
      entry.textContent = `[${time}] ${msg}`;
      logEl.appendChild(entry);
      logEl.scrollTop = logEl.scrollHeight;
      console.log(msg);
    }

    // Mock functions from configurator
    function getSelections() {
      return {
        level: document.querySelector('input[name="level"]:checked')?.value || null,
        frequency: document.querySelector('input[name="frequency"]:checked')?.value || null
      };
    }

    function canConfigure() {
      log('canConfigure() called', 'info');
      // Simplified version
      return true;
    }

    function showPaywall() {
      log('showPaywall() called', 'error');
      alert('Paywall!');
    }

    function goToStep(step) {
      log(`goToStep(${step}) called`, 'success');
    }

    // Test function
    function testGenerateResult() {
      log('=== testGenerateResult START ===', 'success');
      
      try {
        const selections = getSelections();
        log(`Selections: ${JSON.stringify(selections)}`, 'info');
        
        const canUse = canConfigure();
        log(`canConfigure: ${canUse}`, 'info');
        
        if (!canUse) {
          log('Showing paywall...', 'error');
          showPaywall();
          return;
        }
        
        log('‚úÖ Would generate results here', 'success');
        log(`Level: ${selections.level}, Frequency: ${selections.frequency}`, 'info');
        
        // Simulate going to results
        setTimeout(() => {
          log('Going to step 4...', 'success');
          goToStep(4);
        }, 1000);
        
      } catch (error) {
        log(`‚ùå ERROR: ${error.message}`, 'error');
        log(`Stack: ${error.stack}`, 'error');
      }
    }

    // Expose globally
    window.testGenerateResult = testGenerateResult;

    // Test with addEventListener
    document.getElementById('testBtn2')?.addEventListener('click', function() {
      log('=== addEventListener version ===', 'info');
      testGenerateResult();
    });

    log('Page loaded - ready for testing', 'success');
  </script>
</body>
</html>
